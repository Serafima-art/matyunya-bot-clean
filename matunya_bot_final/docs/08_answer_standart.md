üìò –ü–ê–ú–Ø–¢–ö–ê: –ö–ê–ö –£–°–¢–†–û–ï–ù–ê –°–ò–°–¢–ï–ú–ê –û–¢–í–ï–¢–û–í –î–õ–Ø –ó–ê–î–ê–ù–ò–ô 6 –ò 8

–≠—Ç–∞ –ø–∞–º—è—Ç–∫–∞ ‚Äî –æ—Å–Ω–æ–≤–∞, –Ω–∞ –∫–æ—Ç–æ—Ä–æ–π –¥–æ–ª–∂–Ω—ã —Å—Ç—Ä–æ–∏—Ç—å—Å—è –≤—Å–µ –±—É–¥—É—â–∏–µ task_X_answer_handler.py.

üü¶ 1. –û–±—â–∏–π –ø—Ä–∏–Ω—Ü–∏–ø

–î–ª—è –∑–∞–¥–∞–Ω–∏–π 6 –∏ 8 –º—ã –≤–Ω–µ–¥—Ä–∏–ª–∏ –æ–¥–Ω—É –∏ —Ç—É –∂–µ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É:

‚úîÔ∏è –û–¥–∏–Ω –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ callback –∑–∞–ø—É—Å–∫–∞–µ—Ç –∑–∞–¥–∞–Ω–∏–µ

(task_6_handler.py / task_8_handler.py)

‚úîÔ∏è –ó–∞–¥–∞–Ω–∏–µ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ FSM

(—á–µ—Ä–µ–∑ –æ–∂–∏–¥–∞—é—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ: waiting_for_answer)

‚úîÔ∏è –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–≤–æ–¥–∏—Ç –æ—Ç–≤–µ—Ç ‚Üí

–º—ã —á–∏—Ç–∞–µ–º –æ—Ç–≤–µ—Ç –∏–∑ message.text –∏ —Å—Ä–∞–≤–Ω–∏–≤–∞–µ–º —Å correct_answer.

‚úîÔ∏è –ü–æ—Å–ª–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º:

–∑–µ–ª—ë–Ω—É—é –≥–∞–ª–æ—á–∫—É (–ø—Ä–∞–≤–∏–ª—å–Ω–æ)

–∫—Ä–∞—Å–Ω—ã–π –∫—Ä–µ—Å—Ç–∏–∫ (–Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ)

–ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ –ø–æ–ª—É—á–∏—Ç—å –ø–æ–º–æ—â—å (–µ—Å–ª–∏ –æ—à–∏–±–∫–∞)

inline-–∫–ª–∞–≤–∏–∞—Ç—É—Ä—É (–¥–∞–ª—å–Ω–µ–π—à–∏–µ –¥–µ–π—Å—Ç–≤–∏—è)

üü¶ 2. FSM-—Å–æ—Å—Ç–æ—è–Ω–∏—è, –∫–æ—Ç–æ—Ä—ã–µ –º—ã –≤—ã–±—Ä–∞–ª–∏

–ú—ã —Å–¥–µ–ª–∞–ª–∏ –ø—Ä–æ—Å—Ç—É—é, –Ω–æ –Ω–∞–¥—ë–∂–Ω—É—é FSM:

–î–ª—è –∑–∞–¥–∞–Ω–∏—è 6:
class Task6States(StatesGroup):
    waiting_for_answer = State()


—Å–æ—Å—Ç–æ—è–Ω–∏–µ –∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç—Å—è, –∫–æ–≥–¥–∞ –±–æ—Ç –ø–æ–∫–∞–∑–∞–ª –∑–∞–¥–∞–Ω–∏–µ

–æ—á–∏—â–∞–µ—Ç—Å—è, –∫–æ–≥–¥–∞ –æ—Ç–≤–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∞–Ω

–≤ state –º—ã —Ö—Ä–∞–Ω–∏–º:

task_data (–≤–µ—Å—å JSON)

correct_answer

task_type

subtype

–î–ª—è –∑–∞–¥–∞–Ω–∏—è 8:

–¢–æ—á–Ω–æ —Ç–∞–∫–∞—è –∂–µ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞:

class Task8States(StatesGroup):
    waiting_for_answer = State()


FSM –æ–¥–∏–Ω–∞–∫–æ–≤–∞ –º–µ–∂–¥—É –∑–∞–¥–∞–Ω–∏—è–º–∏, —á—Ç–æ–±—ã —Å–∏—Å—Ç–µ–º–∞ –±—ã–ª–∞ —É–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–∞.

üü¶ 3. –ß—Ç–æ –º—ã —Å–æ—Ö—Ä–∞–Ω—è–µ–º –≤ FSM –ø–µ—Ä–µ–¥ —Ç–µ–º, –∫–∞–∫ –∂–¥–∞—Ç—å –æ—Ç–≤–µ—Ç

–≠—Ç–æ –∫–ª—é—á–µ–≤–æ–π –º–æ–º–µ–Ω—Ç, —Ä–∞–¥–∏ –∫–æ—Ç–æ—Ä–æ–≥–æ –º—ã –≤–æ–æ–±—â–µ –¥–µ–ª–∞–ª–∏ —ç—Ç—É –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É.

–í task_6_handler.py –∏ task_8_handler.py –º—ã –∑–∞–ø–æ–ª–Ω—è–µ–º:

await state.update_data(
    task_type="6",
    subtype=subtype,
    task_data=task_dict,
    correct_answer=task.correct_answer,
)
await state.set_state(Task6States.waiting_for_answer)


–ê–Ω–∞–ª–æ–≥–∏—á–Ω–æ ‚Äî –≤ task_8.

–≠—Ç–æ –¥–∞—ë—Ç —Å–ª–µ–¥—É—é—â–∏–µ –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:

‚úî –ë–æ—Ç –∑–Ω–∞–µ—Ç, —á—Ç–æ —Å–µ–π—á–∞—Å –∏–¥—ë—Ç –æ—Ç–≤–µ—Ç –Ω–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–µ –∑–∞–¥–∞–Ω–∏–µ
‚úî –ë–æ—Ç –º–æ–∂–µ—Ç –¥–∞—Ç—å –ø–æ–º–æ—â—å –∏–º–µ–Ω–Ω–æ –ø–æ —ç—Ç–æ–º—É –∑–∞–¥–∞–Ω–∏—é
‚úî –ë–æ—Ç –Ω–µ ¬´–ø—É—Ç–∞–µ—Ç¬ª —Å–æ–æ–±—â–µ–Ω–∏—è —É—á–µ–Ω–∏–∫–∞
‚úî –ú–æ–∂–Ω–æ –≤–µ—Å—Ç–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É (task_data –≤ state ‚Üí –ª–æ–≥ –≤ –ë–î)
üü¶ 4. –°—Ç—Ä—É–∫—Ç—É—Ä–∞ task_6_answer_handler.py / task_8_answer_handler.py

–û–±–∞ —Ñ–∞–π–ª–∞ –ø–æ—Å—Ç—Ä–æ–µ–Ω—ã –æ–¥–∏–Ω–∞–∫–æ–≤–æ ‚Äî —ç—Ç–æ –≤–∞–∂–Ω–æ –¥–ª—è –±—É–¥—É—â–∏—Ö –∑–∞–¥–∞—á.

üîπ 1. –§–∏–ª—å—Ç—Ä: —Å–æ–æ–±—â–µ–Ω–∏–µ –ø—Ä–∏–Ω–∏–º–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –∫–æ–≥–¥–∞ FSM = waiting_for_answer

–ü—Ä–∏–º–µ—Ä:

@router.message(Task6States.waiting_for_answer)
async def process_task6_answer(message: Message, state: FSMContext):


–≠—Ç–æ –∑–∞—â–∏—â–∞–µ—Ç –±–æ—Ç–∞ –æ—Ç —Å–ª—É—á–∞–π–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π —É—á–µ–Ω–∏–∫–∞.

üîπ 2. –î–æ—Å—Ç–∞—ë–º –¥–∞–Ω–Ω—ã–µ –∏–∑ FSM
data = await state.get_data()
correct_answer = str(data["correct_answer"]).strip()
user_answer = message.text.strip()

üîπ 3. –°—Ä–∞–≤–Ω–µ–Ω–∏–µ

–ú—ã –∏—Å–ø–æ–ª—å–∑—É–µ–º —É–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—É—é –ø—Ä–æ–≤–µ—Ä–∫—É:

–ü—Ä–∞–≤–∏–ª—å–Ω–æ:
if user_answer == correct_answer:
    ...

–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ:

–ü—Ä–µ–¥–ª–∞–≥–∞–µ–º –∫–Ω–æ–ø–∫—É ¬´–ü–æ–º–æ—â—å¬ª (–≤ –∑–∞–¥–∞–Ω–∏—è—Ö —Å help-—Å–∏—Å—Ç–µ–º–æ–π).

üîπ 4. –†–µ–∞–∫—Ü–∏—è –±–æ—Ç–∞
–ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç:

—ç–º–æ–¥–∑–∏ ¬´–≥–∞–ª–æ—á–∫–∞¬ª

–∫–æ—Ä–æ—Ç–∫–∞—è –ø–æ—Ö–≤–∞–ª–∞ (–≤ —Å—Ç–∏–ª–µ –ú–∞—Ç—é–Ω–∏)

–∫–Ω–æ–ø–∫–∏:

üß© –ü–æ—Ö–æ–∂–µ–µ –∑–∞–¥–∞–Ω–∏–µ

üîù –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é

üîô –ù–∞–∑–∞–¥

–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π:

–∫—Ä–∞—Å–Ω—ã–π –∫—Ä–µ—Å—Ç–∏–∫

–∫–æ—Ä–æ—Ç–∫–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞

–∫–Ω–æ–ø–∫–∞ ¬´–•–æ—á—É –ø–æ–º–æ—â—å¬ª

üîπ 5. –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è

–ú—ã –¥–µ–ª–∞–µ–º:

await state.clear()


—á—Ç–æ–±—ã FSM –Ω–µ –≤–∏—Å–µ–ª–∞ –Ω–∞ –æ–∂–∏–¥–∞–Ω–∏–∏.

üü¶ 5. –ö–ª—é—á–µ–≤—ã–µ –ø—Ä–∞–≤–∏–ª–∞ —ç—Ç–æ–π —Å–∏—Å—Ç–µ–º—ã

–ß—Ç–æ–±—ã –Ω–æ–≤—ã–µ –∑–∞–¥–∞–Ω–∏—è –±—ã–ª–∏ —Ç–∞–∫–∏–º–∏ –∂–µ —É—Å—Ç–æ–π—á–∏–≤—ã–º–∏, –Ω–∞–¥–æ —Å–æ–±–ª—é–¥–∞—Ç—å —ç—Ç–∏ –ø—Ä–∞–≤–∏–ª–∞ —Å–∏—Å—Ç–µ–º—ã:

1. –ö–∞–∂–¥–æ–µ –∑–∞–¥–∞–Ω–∏–µ –∏–º–µ–µ—Ç —Å–≤–æ–π waiting_for_answer

–ù–µ wait_for_answer_7, –Ω–µ answer_state, –∞ —Å—Ç—Ä–æ–≥–æ –ø–æ —à–∞–±–ª–æ–Ω—É:

TaskXStates.waiting_for_answer


–≠—Ç–æ —É–Ω–∏—Ñ–∏—Ü–∏—Ä—É–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∫—É –∏ —É–ø—Ä–æ—â–∞–µ—Ç –≤–Ω–µ–¥—Ä–µ–Ω–∏–µ help.

2. –í FSM —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –ø–æ–ª–Ω—ã–π task_data

–≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç:

–ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –ø–æ–º–æ—â—å

–ø–µ—Ä–µ—Å–æ–±—Ä–∞—Ç—å –∑–∞–¥–∞—á—É

–ø–æ–∫–∞–∑–∞—Ç—å —à–∞–≥–∏

–∑–∞–ø–∏—Å–∞—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É

–≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∫–æ–Ω—Ç–µ–∫—Å—Ç

3. –ù–µ–ª—å–∑—è –ø—Ä–æ–≤–µ—Ä—è—Ç—å –æ—Ç–≤–µ—Ç –±–µ–∑ FSM

–ò–Ω–∞—á–µ –±–æ—Ç –Ω–∞—á–Ω—ë—Ç —Ä–µ–∞–≥–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ –ª—é–±—ã–µ —Ü–∏—Ñ—Ä—ã.

4. –û—Ç–≤–µ—Ç –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —Å—Ç—Ä–æ–∫–æ–π

–ß—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å –Ω–µ—è–≤–Ω—ã—Ö –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–π, –º—ã –¥–µ–ª–∞–µ–º:

user_answer = message.text.strip()
correct_answer = str(correct_answer_from_json)

5. –û—à–∏–±–∫–∏ –≤—Å–µ–≥–¥–∞ –¥—Ä—É–∂–µ–ª—é–±–Ω—ã–µ

–≠—Ç–æ —á–∞—Å—Ç—å —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∞ –ú–∞—Ç—é–Ω–∏.

6. –ü–æ—Å–ª–µ –æ—Ç–≤–µ—Ç–∞ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –æ—á–∏—â–∞–µ—Ç—Å—è

–ß—Ç–æ–±—ã:

–±–æ—Ç –Ω–µ –¥—É–º–∞–ª, —á—Ç–æ —É—á–µ–Ω–∏–∫ –≤—Å—ë –µ—â—ë —Ä–µ—à–∞–µ—Ç —Å—Ç–∞—Ä–æ–µ –∑–∞–¥–∞–Ω–∏–µ

–Ω–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è —à–ª–∏ –≤ —á–∞—Ç, –∞ –Ω–µ –≤ –ø—Ä–æ–≤–µ—Ä–∫—É

üü¶ 6. –ß—Ç–æ –≤–∞–∂–Ω–æ –ø–æ–º–Ω–∏—Ç—å –¥–ª—è –±—É–¥—É—â–∏—Ö –∑–∞–¥–∞–Ω–∏–π
‚≠ê –í—Å–µ –Ω–æ–≤—ã–µ –∑–∞–¥–∞–Ω–∏—è –±—É–¥—É—Ç –ø–æ—Å—Ç—Ä–æ–µ–Ω—ã –ø–æ —à–∞–±–ª–æ–Ω—É –∑–∞–¥–∞–Ω–∏—è 6 –∏ 8

(–æ–±—Ä–∞–±–æ—Ç—á–∏–∫ ‚Üí FSM ‚Üí –ø—Ä–æ–≤–µ—Ä–∫–∞ ‚Üí –∫–ª–∞–≤–∏–∞—Ç—É—Ä–∞)

‚≠ê –°–æ—Å—Ç–æ—è–Ω–∏–µ —Ç–æ–ª—å–∫–æ –æ–¥–Ω–æ: waiting_for_answer

(–ú—ã –Ω–µ –ø–ª–æ–¥–∏–º 10 —Å–æ—Å—Ç–æ—è–Ω–∏–π)

‚≠ê –£–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç JSON —á–µ—Ä–µ–∑ task_data

(–≠—Ç–æ —Ñ—É–Ω–¥–∞–º–µ–Ω—Ç –¥–ª—è help-core)

‚≠ê –í –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–µ –æ—Ç–≤–µ—Ç–∞ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å:

–ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∏–∑ FSM

–ü—Ä–æ–≤–µ—Ä–∫–∞

–í–µ—Ç–∫–∞ ¬´–ø—Ä–∞–≤–∏–ª—å–Ω–æ / –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ¬ª

–í—ã–≤–æ–¥ –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã

state.clear()

üü¶ 7. –ü–æ—á–µ–º—É —ç—Ç–∞ —Å–∏—Å—Ç–µ–º–∞ ‚Äî –ª—É—á—à–∞—è –±–∞–∑–∞ –¥–ª—è –±—É–¥—É—â–∏—Ö –∑–∞–¥–∞–Ω–∏–π

–û–Ω–∞:

–º–∏–Ω–∏–º–∞–ª—å–Ω–∞—è

—É—Å—Ç–æ–π—á–∏–≤–∞—è

–ª–µ–≥–∫–æ —Ä–∞—Å—à–∏—Ä—è–µ—Ç—Å—è (–º—ã —É–∂–µ –∑–Ω–∞–µ–º, –∫–∞–∫ –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è help-core)

–æ–¥–∏–Ω–∞–∫–æ–≤–∞—è –¥–ª—è –≤—Å–µ—Ö –∑–∞–¥–∞—á

–Ω–µ –ª–æ–º–∞–µ—Ç –¥–∏–∞–ª–æ–≥ –±–æ—Ç–∞

–ø–æ–¥—Ö–æ–¥–∏—Ç –ø–æ–¥ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É

—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ Matyunya v2



‚≠ê –≠–¢–ê–õ–û–ù–ù–´–ô –®–ê–ë–õ–û–ù
task_X_answer_handler.py

(–ø–æ–ª–Ω–æ—Å—Ç—å—é —Å–æ–≤–º–µ—Å—Ç–∏–º—ã–π —Å –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–æ–π Matyunya v2, –∑–∞–¥–∞–Ω–∏—è–º–∏ 6 –∏ 8, –∏ help-core)

üìò 1. FSM-—Å–æ—Å—Ç–æ—è–Ω–∏–µ –¥–ª—è –∑–∞–¥–∞–Ω–∏—è X

–°–æ–∑–¥–∞—ë—Ç—Å—è –≤ —Ñ–∞–π–ª–µ states/task_states.py –∏–ª–∏ –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–º —Ñ–∞–π–ª–µ:

from aiogram.fsm.state import State, StatesGroup

class TaskXStates(StatesGroup):
    waiting_for_answer = State()

üìò 2. Handler –¥–ª—è –æ—Ç–≤–µ—Ç–∞ ‚Äî —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π —à–∞–±–ª–æ–Ω

–°–æ–∑–¥–∞—ë—Ç—Å—è —Ñ–∞–π–ª:

matunya_bot_final/handlers/message_handlers/task_X_answer_handler.py


–ö–æ–¥:

# -*- coding: utf-8 -*-
"""
–≠—Ç–∞–ª–æ–Ω–Ω—ã–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –æ—Ç–≤–µ—Ç–æ–≤ –¥–ª—è –∑–∞–¥–∞–Ω–∏—è X.
–ü–æ–ª–Ω–æ—Å—Ç—å—é —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ —Ä–µ—à–µ–Ω–∏–π –¥–ª—è –∑–∞–¥–∞—á 6 –∏ 8.
"""

from aiogram import Router
from aiogram.types import Message
from aiogram.fsm.context import FSMContext
from sqlalchemy.ext.asyncio import async_sessionmaker

from matunya_bot_final.states.task_states import TaskXStates
from matunya_bot_final.keyboards.after_task_keyboard import after_task_keyboard

# –î–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
import logging
logger = logging.getLogger(__name__)

# –°–æ–∑–¥–∞–µ–º —Ä–æ—É—Ç–µ—Ä
router = Router(name="task_X_answer_handler")


# ==========================
# üî• –û–ë–†–ê–ë–û–¢–ö–ê –û–¢–í–ï–¢–ê –£–ß–ï–ù–ò–ö–ê
# ==========================

@router.message(TaskXStates.waiting_for_answer)
async def process_task_X_answer(message: Message, state: FSMContext, session_maker: async_sessionmaker):
    """
    –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –æ—Ç–≤–µ—Ç–æ–≤ –Ω–∞ –ª—é–±–æ–µ –∑–∞–¥–∞–Ω–∏–µ.
    –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –æ–¥–∏–Ω–∞–∫–æ–≤–∞—è –ª–æ–≥–∏–∫–∞:
    - —á–∏—Ç–∞–µ–º task_data –∏ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç –∏–∑ FSM
    - —Å—Ä–∞–≤–Ω–∏–≤–∞–µ–º
    - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Ä–µ–∞–∫—Ü–∏—é
    - –¥–∞–µ–º –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É –¥–∞–ª—å–Ω–µ–π—à–∏—Ö –¥–µ–π—Å—Ç–≤–∏–π
    """

    user_answer = message.text.strip()

    # 1) –î–æ—Å—Ç–∞–µ–º –¥–∞–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏ –∏–∑ FSM
    data = await state.get_data()

    task_type = data.get("task_type")
    subtype = data.get("subtype")
    task_data = data.get("task_data")
    correct_answer = str(data.get("correct_answer")).strip()

    logger.info(
        f"[Task {task_type}] –ü–æ–ª—É—á–µ–Ω –æ—Ç–≤–µ—Ç: {user_answer}, "
        f"–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π: {correct_answer}, –ø–æ–¥—Ç–∏–ø: {subtype}"
    )

    # 2) –ü—Ä–æ–≤–µ—Ä—è–µ–º –æ—Ç–≤–µ—Ç
    if user_answer == correct_answer:
        # -------------------------
        # üéâ –ü–†–ê–í–ò–õ–¨–ù–´–ô –û–¢–í–ï–¢
        # -------------------------
        text = (
            "üü¢ <b>–ü—Ä–∞–≤–∏–ª—å–Ω–æ!</b>\n"
            "–û—Ç–ª–∏—á–Ω–∞—è —Ä–∞–±–æ—Ç–∞, —Ç–∞–∫ –¥–µ—Ä–∂–∞—Ç—å! üí™\n\n"
            "–í—ã–±–µ—Ä–∏, —á—Ç–æ –¥–µ–ª–∞–µ–º –¥–∞–ª—å—à–µ:"
        )

        await message.answer(
            text,
            reply_markup=after_task_keyboard(
                task_type=task_type,
                subtype=subtype,
                is_correct=True
            ),
        )

    else:
        # -------------------------
        # ‚ùå –ù–ï–ü–†–ê–í–ò–õ–¨–ù–´–ô –û–¢–í–ï–¢
        # -------------------------
        text = (
            "üî¥ <b>–ù–µ —Å–æ–≤—Å–µ–º —Ç–∞–∫‚Ä¶</b>\n"
            "–ù–æ –Ω–∏—á–µ–≥–æ —Å—Ç—Ä–∞—à–Ω–æ–≥–æ! –•–æ—á–µ—à—å —Ä–∞–∑–±–µ—Ä—ë–º –≤–º–µ—Å—Ç–µ? üòä"
        )

        await message.answer(
            text,
            reply_markup=after_task_keyboard(
                task_type=task_type,
                subtype=subtype,
                is_correct=False
            ),
        )

    # 3) –í–∞–∂–Ω–æ: –æ—á–∏—â–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ (–∏–ª–∏ –ø–µ—Ä–µ–∫–ª—é—á–∞–µ–º—Å—è –≤ help –ø—Ä–∏ –æ—à–∏–±–∫–µ)
    await state.clear()

üìò 3. –ö–∞–∫ —Ä–∞–±–æ—Ç–∞—Ç—å —Å –Ω–∏–º –≤ handler, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∑–∞–¥–∞–Ω–∏–µ

–õ—é–±–æ–π task_X_handler –¥–æ–ª–∂–µ–Ω –¥–µ–ª–∞—Ç—å:

await state.update_data(
    task_type="X",
    subtype=subtype,
    task_data=task_json,
    correct_answer=task_json["answer"]
)

await state.set_state(TaskXStates.waiting_for_answer)


–≠—Ç–æ –≥–ª–∞–≤–Ω—ã–π –∫–æ–Ω—Ç—Ä–∞–∫—Ç, –∫–æ—Ç–æ—Ä—ã–π –¥–∞—ë—Ç:

–ø—Ä–∞–≤–∏–ª—å–Ω—É—é –ø—Ä–æ–≤–µ—Ä–∫—É

—Ä–∞–±–æ—Ç—É help-—Å–∏—Å—Ç–µ–º—ã

–≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏

—É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–æ—Å—Ç—å across all tasks

üìò 4. –ö–ª–∞–≤–∏–∞—Ç—É—Ä–∞ after_task_keyboard

–ú—ã –∏—Å–ø–æ–ª—å–∑—É–µ–º –µ–¥–∏–Ω—É—é –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É, –∫–∞–∫ –≤ –∑–∞–¥–∞–Ω–∏—è—Ö 6 –∏ 8:

üß© –ü–æ—Ö–æ–∂–µ–µ –∑–∞–¥–∞–Ω–∏–µ  
üßÆ –¢–µ–æ—Ä–∏—è  
üîô –ù–∞–∑–∞–¥ –∫ —Ç–µ–º–∞–º  
üîù –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é


–§–∞–π–ª:

matunya_bot_final/keyboards/after_task_keyboard.py

üìò 5. –ì–¥–µ —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å —Ä–æ—É—Ç–µ—Ä

–í—Å—Ç–∞–≤–∏—Ç—å –≤ handlers/__init__.py:

from matunya_bot_final.handlers.message_handlers.task_X_answer_handler import router as task_X_answer_router


–ò –¥–æ–±–∞–≤–∏—Ç—å –≤ —Å–ø–∏—Å–æ–∫ routers:

task_X_answer_router,

üìò 6. –ß—Ç–æ –ù–ï–õ–¨–ó–Ø –º–µ–Ω—è—Ç—å –≤ —ç—Ç–æ–º —à–∞–±–ª–æ–Ω–µ

–ß—Ç–æ–±—ã —Å–∏—Å—Ç–µ–º–∞ –Ω–µ —Å–ª–æ–º–∞–ª–∞—Å—å:

‚ùå –Ω–µ–ª—å–∑—è –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤—ã–≤–∞—Ç—å waiting_for_answer
‚ùå –Ω–µ–ª—å–∑—è —Å–æ—Ö—Ä–∞–Ω—è—Ç—å –≤ FSM —á—Ç–æ-—Ç–æ –≤ –¥—Ä—É–≥–∏—Ö –∫–ª—é—á–∞—Ö
‚ùå –Ω–µ–ª—å–∑—è –ø—Ä–æ–≤–µ—Ä—è—Ç—å –æ—Ç–≤–µ—Ç –¥–æ FSM
‚ùå –Ω–µ–ª—å–∑—è —É–±–∏—Ä–∞—Ç—å .strip()
‚ùå –Ω–µ–ª—å–∑—è —É–¥–∞–ª—è—Ç—å task_data ‚Äî –æ–Ω–æ –Ω—É–∂–Ω–æ help-–º–æ–¥—É–ª—é
‚ùå –Ω–µ–ª—å–∑—è –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É –±–µ–∑ —É–∫–∞–∑–∞–Ω–∏—è task_type

üìò 7. –ß—Ç–æ –º–æ–∂–Ω–æ –º–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å –≤ –±—É–¥—É—â–µ–º

‚úîÔ∏è —Å—Ç–∏–ª—å –æ—Ç–≤–µ—Ç–∞ (—ç–º–æ–¥–∑–∏, —Ç–æ–Ω)
‚úîÔ∏è –¥–æ–±–∞–≤–ª—è—Ç—å –∞–Ω–∞–ª–∏—Ç–∏–∫—É (–ª–æ–≥ –≤ –ë–î)
‚úîÔ∏è –¥–æ–±–∞–≤–ª—è—Ç—å –∫–Ω–æ–ø–∫–∏ –≤ –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É
‚úîÔ∏è –∏–∑–º–µ–Ω—è—Ç—å —Ç–µ–∫—Å—Ç ¬´–ø—Ä–∞–≤–∏–ª—å–Ω–æ / –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ¬ª
‚úîÔ∏è –≤–∫–ª—é—á–∞—Ç—å help —Å—Ä–∞–∑—É (–Ω–∞–ø—Ä–∏–º–µ—Ä, –¥–ª—è –∑–∞–¥–∞—á 11 –∏–ª–∏ 20)
