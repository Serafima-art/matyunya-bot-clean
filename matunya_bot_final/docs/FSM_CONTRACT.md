üìú FSM_CONTRACT.md
–ö–æ–Ω—Ç—Ä–∞–∫—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–π (FSM) –ø—Ä–æ–µ–∫—Ç–∞ ¬´–ú–∞—Ç—é–Ω—è¬ª
–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞

–≠—Ç–æ—Ç –¥–æ–∫—É–º–µ–Ω—Ç –æ–ø–∏—Å—ã–≤–∞–µ—Ç –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–∞–≤–∏–ª–∞ (–∫–æ–Ω—Ç—Ä–∞–∫—Ç) —Ä–∞–±–æ—Ç—ã —Å FSM (Finite State Machine)
–≤ –ø—Ä–æ–µ–∫—Ç–µ ¬´–ú–∞—Ç—é–Ω—è¬ª.

–ö–æ–Ω—Ç—Ä–∞–∫—Ç –Ω—É–∂–µ–Ω –¥–ª—è —Ç–æ–≥–æ, —á—Ç–æ–±—ã:

–∏–∑–±–µ–∂–∞—Ç—å ¬´—Ç–∏—Ö–∏—Ö –ø–æ–ª–æ–º–æ–∫¬ª –ª–æ–≥–∏–∫–∏;

–≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω—É—é —Ä–∞–±–æ—Ç—É –ø–æ–º–æ—â–∏, –ø—Ä–æ–≤–µ—Ä–∫–∏ –æ—Ç–≤–µ—Ç–æ–≤ –∏ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏;

–ø–æ–∑–≤–æ–ª–∏—Ç—å AI-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–∞–º –∏ –ª—é–¥—è–º –ø–∏—Å–∞—Ç—å –∫–æ–¥, –Ω–µ –∑–Ω–∞—è –≤—Å–µ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã –ø—Ä–æ–µ–∫—Ç–∞.

‚ö†Ô∏è –ù–∞—Ä—É—à–µ–Ω–∏–µ FSM-–∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞ —Å—á–∏—Ç–∞–µ—Ç—Å—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–æ–π –æ—à–∏–±–∫–æ–π.

1. –ë–∞–∑–æ–≤–æ–µ –ø–æ–Ω—è—Ç–∏–µ: index
–ß—Ç–æ —Ç–∞–∫–æ–µ index

index ‚Äî —ç—Ç–æ –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ –ø—Ä–∞–≤–¥—ã –æ —Ç–æ–º,
–∫–∞–∫–æ–π –∏–º–µ–Ω–Ω–æ –≤–æ–ø—Ä–æ—Å / –ø–æ–¥–∑–∞–¥–∞—á–∞ / —à–∞–≥ —Å–µ–π—á–∞—Å –∞–∫—Ç–∏–≤–µ–Ω —É —É—á–µ–Ω–∏–∫–∞.

–û–Ω –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è:

–ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ –æ—Ç–≤–µ—Ç–∞;

–ø—Ä–∏ –≤—ã–∑–æ–≤–µ –ø–æ–º–æ—â–∏;

–ø—Ä–∏ –≤–æ–∑–≤—Ä–∞—Ç–µ –∫ —Ç–µ–∫—É—â–µ–º—É –∑–∞–¥–∞–Ω–∏—é;

–ø—Ä–∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–∏.

2. –ì–ª–∞–≤–Ω—ã–π FSM-–∏–Ω–≤–∞—Ä–∏–∞–Ω—Ç (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ –ø—Ä–∞–≤–∏–ª–æ)

‚ùó –ï—Å–ª–∏ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è Help (–ü–æ–º–æ—â—å), –≤ FSM –û–ë–Ø–ó–ê–ù —Å—É—â–µ—Å—Ç–≤–æ–≤–∞—Ç—å state["index"].

–§–æ—Ä–º–∞–ª—å–Ω–æ:

Help –≤—ã–∑–≤–∞–Ω  ‚Üí  state["index"] —Å—É—â–µ—Å—Ç–≤—É–µ—Ç


–ï—Å–ª–∏ —ç—Ç–æ —É—Å–ª–æ–≤–∏–µ –Ω–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ:

–ø–æ–º–æ—â—å –Ω–µ –¥–æ–ª–∂–Ω–∞ –∑–∞–ø—É—Å–∫–∞—Ç—å—Å—è;

–¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –∑–∞–ø–∏—Å–∞–Ω–∞ CRITICAL-–æ—à–∏–±–∫–∞ –≤ –ª–æ–≥;

–≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –ø—Ä–µ—Ä–≤–∞–Ω–æ.

2.1 –ö–∞–∂–¥—ã–π answer_handler –æ–±—è–∑–∞–Ω –≤—ã–∑—ã–≤–∞—Ç—å ensure_task_index –≤ –Ω–∞—á–∞–ª–µ

3. –ö—Ç–æ –æ–±—è–∑–∞–Ω —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—Ç—å index
index –û–ë–Ø–ó–ê–ù –±—ã—Ç—å —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω:

–ø—Ä–∏ –ø–æ–∫–∞–∑–µ —Ñ–æ–∫—É—Å–Ω–æ–≥–æ –∑–∞–¥–∞–Ω–∏—è;

–ø—Ä–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–∏ –º–µ–∂–¥—É –≤–æ–ø—Ä–æ—Å–∞–º–∏ –≤–Ω—É—Ç—Ä–∏ –∑–∞–¥–∞–Ω–∏—è;

–¥–æ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è waiting_for_answer.

–î–æ–ø—É—Å–∫–∞–µ—Ç—Å—è fallback:

–ï—Å–ª–∏ index –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç, –Ω–æ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç:

current_task_index

—Ç–æ –¥–æ–ø—É—Å—Ç–∏–º–æ:

–æ–¥–Ω–æ–∫—Ä–∞—Ç–Ω–æ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å index –∏–∑ current_task_index

—Å—Ä–∞–∑—É —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –µ–≥–æ –≤ FSM

–≠—Ç–æ —Å—á–∏—Ç–∞–µ—Ç—Å—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ–º –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞, –∞ –Ω–µ –Ω–æ—Ä–º–∞–ª—å–Ω–æ–π –ª–æ–≥–∏–∫–æ–π.

4. –ó–∞–ø—Ä–µ—â—ë–Ω–Ω—ã–µ —Å–∏—Ç—É–∞—Ü–∏–∏

‚õî –ó–∞–ø—Ä–µ—â–µ–Ω–æ:

–≤—ã–∑—ã–≤–∞—Ç—å Help, –µ—Å–ª–∏ index –Ω–µ –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω;

–ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å –Ω–æ–º–µ—Ä –≤–æ–ø—Ä–æ—Å–∞ —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ callback –±–µ–∑ FSM;

—Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞—Ç—å index ¬´–Ω–∞ –ª–µ—Ç—É¬ª –≤ solver‚Äô–∞—Ö;

–∏–º–µ—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –∫–æ–Ω–∫—É—Ä–∏—Ä—É—é—â–∏—Ö –∏–Ω–¥–µ–∫—Å–æ–≤ (question_num, task_num, current_index) –±–µ–∑ —è–≤–Ω–æ–≥–æ –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞.

5. –†–æ–ª—å helper‚Äô–æ–≤ (fsm_guards.py)

–í—Å–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ FSM-–∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞:

–¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω—ã

–Ω–µ –¥–æ–ª–∂–Ω—ã –¥—É–±–ª–∏—Ä–æ–≤–∞—Ç—å—Å—è –ø–æ –∫–æ–¥—É

–î–ª—è —ç—Ç–æ–≥–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è helper:

ensure_task_index(state) -> int


–û–Ω:

–≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç –Ω–∞–ª–∏—á–∏–µ state["index"];

–≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π index;

–ª–æ–≥–∏—Ä—É–µ—Ç CRITICAL –ø—Ä–∏ –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è.

–õ—é–±–æ–π –∫–æ–¥, –∫–æ—Ç–æ—Ä—ã–π:

–ø—Ä–æ–≤–µ—Ä—è–µ—Ç –æ—Ç–≤–µ—Ç,

–ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ,

–¥–∞—ë—Ç –∫–Ω–æ–ø–∫—É ¬´üÜò –ü–æ–º–æ—â—å¬ª

üëâ –æ–±—è–∑–∞–Ω –≤—ã–∑–≤–∞—Ç—å ensure_task_index.

6. –û–±–ª–∞—Å—Ç—å –¥–µ–π—Å—Ç–≤–∏—è –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞

FSM-–∫–æ–Ω—Ç—Ä–∞–∫—Ç –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω –¥–ª—è:

–∑–∞–¥–∞–Ω–∏–π 1‚Äì5

–∑–∞–¥–∞–Ω–∏–π 6‚Äì8

–∑–∞–¥–∞–Ω–∏—è 15

–≤—Å–µ—Ö –±—É–¥—É—â–∏—Ö –∑–∞–¥–∞–Ω–∏–π —Å:

–Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ –≤–æ–ø—Ä–æ—Å–∞–º–∏;

—à–∞–≥–∞–º–∏;

–≤–∞—Ä–∏–∞–Ω—Ç–∞–º–∏;

–ø–æ–¥–∑–∞–¥–∞—á–∞–º–∏.

–ö–æ–Ω—Ç—Ä–∞–∫—Ç –Ω–µ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç:

—Ç–∏–ø–∞ –∑–∞–¥–∞–Ω–∏—è;

–ø–æ–¥—Ç–∏–ø–∞;

solver‚Äô–∞;

–Ω–∞–ª–∏—á–∏—è GPT.

7. –ê–≤—Ç–æ—Ç–µ—Å—Ç FSM-–∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞

FSM-–∫–æ–Ω—Ç—Ä–∞–∫—Ç –æ–±—è–∑–∞–Ω –±—ã—Ç—å –∑–∞—â–∏—â—ë–Ω –∞–≤—Ç–æ—Ç–µ—Å—Ç–æ–º.

–¢–µ—Å—Ç:

–ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Ç–æ–ª—å–∫–æ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å —Ä–∞–±–æ—Ç—ã helper‚Äô–æ–≤;

–Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç Telegram;

–Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç aiogram;

–Ω–µ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –ë–î.

–§–∞–π–ª —Ç–µ—Å—Ç–∞:

matunya_bot_final/utils/fsm_guards_test.py


–ï—Å–ª–∏ —Ç–µ—Å—Ç –ø–∞–¥–∞–µ—Ç ‚Äî
–∫–æ–¥ –Ω–µ –º–æ–∂–µ—Ç —Å—á–∏—Ç–∞—Ç—å—Å—è —Ä–∞–±–æ—á–∏–º, –¥–∞–∂–µ –µ—Å–ª–∏ ¬´–≤–∏–∑—É–∞–ª—å–Ω–æ –≤—Å—ë —Ä–∞–±–æ—Ç–∞–µ—Ç¬ª.

8. –§–∏–ª–æ—Å–æ—Ñ–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–∞

–≠—Ç–æ—Ç –∫–æ–Ω—Ç—Ä–∞–∫—Ç –≤–≤–µ–¥—ë–Ω –ø–æ—Ç–æ–º—É —á—Ç–æ:

–∫–æ–¥ –ø–∏—à–µ—Ç—Å—è —Å –ø–æ–º–æ—â—å—é AI;

AI –Ω–µ —É–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –≤—Å—é –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É –ø—Ä–æ–µ–∫—Ç–∞;

—á–µ–ª–æ–≤–µ–∫-–∞–≤—Ç–æ—Ä –ø—Ä–æ–µ–∫—Ç–∞ –Ω–µ –æ–±—è–∑–∞–Ω –∑–Ω–∞—Ç—å Python-–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É;

–ø—Ä–æ–µ–∫—Ç –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –∂–∏–≤—ã–º –∏ —Ä–∞—Å—à–∏—Ä—è–µ–º—ã–º, –∞ –Ω–µ —Ö—Ä—É–ø–∫–∏–º.

FSM-–∫–æ–Ω—Ç—Ä–∞–∫—Ç ‚Äî —ç—Ç–æ —è–∫–æ—Ä—å —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏ –ø—Ä–æ–µ–∫—Ç–∞.

üìå –õ—é–±—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è FSM-–ª–æ–≥–∏–∫–∏ –¥–æ–ª–∂–Ω—ã –Ω–∞—á–∏–Ω–∞—Ç—å—Å—è —Å –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —ç—Ç–æ–≥–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞.
