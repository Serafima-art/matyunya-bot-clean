# matunya_bot_final\help_core\humanizers\template_humanizers\task_1_5\paper_humanizer.py—É

from typing import Dict, Any, Callable

from matunya_bot_final.utils.display import format_number

def _format_numeric_values(context: dict) -> dict:
    formatted = {}
    for k, v in context.items():
        if isinstance(v, (int, float)):
            formatted[k] = format_number(v)
        else:
            formatted[k] = v
    return formatted

# =============================================================================
# 1. –®–ê–ë–õ–û–ù–´ –¢–ï–ö–°–¢–û–í (TEMPLATES) ‚Äî –ù–ï –ú–ï–ù–Ø–ï–ú –§–û–†–ú–£–õ–ò–†–û–í–ö–ò
# =============================================================================

IDEA_TEMPLATES: Dict[str, str] = {

    # ------------------------------------------------------------------
    # üü© –í–û–ü–†–û–° 1 (–ó–∞–¥–∞—á–∞ –Ω–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ)
    ## –ü–∞—Ç—Ç–µ—Ä–Ω paper_format_match
    # ------------------------------------------------------------------

    "match_formats_to_rows":
        "–í —Ç–∞–±–ª–∏—Ü–µ —É–∫–∞–∑–∞–Ω—ã –¥–≤–∞ —Å—Ç–æ–ª–±—Ü–∞:\n\n"
        "<b>–î–ª–∏–Ω–∞ (–º–º) –∏ –®–∏—Ä–∏–Ω–∞ (–º–º).</b>\n\n"
        "–ß—Ç–æ–±—ã –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å, –∫–∞–∫–æ–π –ª–∏—Å—Ç –±–æ–ª—å—à–µ, —É–¥–æ–±–Ω–æ —Å—Ä–∞–≤–Ω–∏—Ç—å –¥–ª–∏–Ω—É.\n"
        "–ß–µ–º –±–æ–ª—å—à–µ –¥–ª–∏–Ω–∞ ‚Äî —Ç–µ–º –±–æ–ª—å—à–µ —Ñ–æ—Ä–º–∞—Ç –ª–∏—Å—Ç–∞.\n\n"
        "–í —Å–µ—Ä–∏–∏ —Ñ–æ—Ä–º–∞—Ç–æ–≤ <b>A</b>:\n"
        "<b>A1 ‚Üí –±–æ–ª—å—à–µ A2 ‚Üí –±–æ–ª—å—à–µ A3 ‚Üí –±–æ–ª—å—à–µ A4 –∏ —Ç–∞–∫ –¥–∞–ª–µ–µ.</b>",

    # ------------------------------------------------------------------
    # üü® –í–û–ü–†–û–° 2 (–ó–∞–¥–∞—á–∞ –Ω–∞ —Ä–∞–∑—Ä–µ–∑–∞–Ω–∏–µ)
    ## –ü–∞—Ç—Ç–µ—Ä–Ω paper_split
    # ------------------------------------------------------------------

    "count_subformats":
        "–ö–∞–∂–¥—ã–π —Å–ª–µ–¥—É—é—â–∏–π —Ñ–æ—Ä–º–∞—Ç –ø–æ–ª—É—á–∞–µ—Ç—Å—è —Ä–∞–∑—Ä–µ–∑–∞–Ω–∏–µ–º –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ –ø–æ–ø–æ–ª–∞–º.\n"
        "–ó–Ω–∞—á–∏—Ç, –ø—Ä–∏ –∫–∞–∂–¥–æ–º –ø–µ—Ä–µ—Ö–æ–¥–µ –∫ —Å–ª–µ–¥—É—é—â–µ–º—É –Ω–æ–º–µ—Ä—É —Ñ–æ—Ä–º–∞—Ç–∞ \n"
        "–∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ª–∏—Å—Ç–æ–≤ —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç—Å—è –≤ <b>2 —Ä–∞–∑–∞</b>.\n"
        "–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ª–∏—Å—Ç–æ–≤ —Ä–∞–≤–Ω–æ <b>2 –≤ —Å—Ç–µ–ø–µ–Ω–∏ —Ä–∞–∑–Ω–æ—Å—Ç–∏ –Ω–æ–º–µ—Ä–æ–≤ —Ñ–æ—Ä–º–∞—Ç–æ–≤.</b>",

    # ------------------------------------------------------------------
    # üü• –í–û–ü–†–û–° 3 (–ü—Ä–∏–∫–ª–∞–¥–Ω–∞—è –∑–∞–¥–∞—á–∞: –Ω–∞–π—Ç–∏ –¥–ª–∏–Ω—É, —à–∏—Ä–∏–Ω—É, —Å–æ–æ—Ç–Ω–æ—à–µ–Ω–∏—è —ç—Ç–∏—Ö –≤–µ–ª–∏—á–∏–Ω)
    ## –ü–∞—Ç—Ç–µ—Ä–Ω paper_dimensions
    # ------------------------------------------------------------------

    "find_length":
        "–í –ø—Ä–µ–¥—ã–¥—É—â–µ–º –∑–∞–¥–∞–Ω–∏–∏ –º—ã –æ–ø—Ä–µ–¥–µ–ª–∏–ª–∏, "
        "–∫–∞–∫–æ–º—É –Ω–æ–º–µ—Ä—É –ª–∏—Å—Ç–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –Ω—É–∂–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç.\n\n"
        "–ü–æ—ç—Ç–æ–º—É –∑–Ω–∞—á–µ–Ω–∏–µ –¥–ª–∏–Ω—ã –Ω–∞—Ö–æ–¥–∏–º –≤ —Ç–∞–±–ª–∏—Ü–µ.",

    "find_width":
        "–í –ø—Ä–µ–¥—ã–¥—É—â–µ–º –∑–∞–¥–∞–Ω–∏–∏ –º—ã –æ–ø—Ä–µ–¥–µ–ª–∏–ª–∏, "
        "–∫–∞–∫–æ–º—É –Ω–æ–º–µ—Ä—É –ª–∏—Å—Ç–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –Ω—É–∂–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç.\n\n"
        "–ü–æ—ç—Ç–æ–º—É –∑–Ω–∞—á–µ–Ω–∏–µ —à–∏—Ä–∏–Ω—ã –Ω–∞—Ö–æ–¥–∏–º –≤ —Ç–∞–±–ª–∏—Ü–µ.",

    "find_side":
        "–ù—É–∂–Ω–æ –≤–∑—è—Ç—å –∏–∑ —Ç–∞–±–ª–∏—Ü—ã –∑–Ω–∞—á–µ–Ω–∏—è –¥–ª–∏–Ω—ã –∏ —à–∏—Ä–∏–Ω—ã –¥–ª—è –¥–∞–Ω–Ω–æ–≥–æ —Ñ–æ—Ä–º–∞—Ç–∞ "
        "–∏ –≤—ã–±—Ä–∞—Ç—å –º–µÃÅ–Ω—å—à–µ–µ –∏–ª–∏ –±–æÃÅ–ª—å—à–µ–µ —á–∏—Å–ª–æ ‚Äî –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —É—Å–ª–æ–≤–∏—è.",

    "find_ratio":
        "–£ –≤—Å–µ—Ö —Ñ–æ—Ä–º–∞—Ç–æ–≤ —Å–µ—Ä–∏–∏ A –æ–¥–∏–Ω–∞–∫–æ–≤–æ–µ —Å–æ–æ—Ç–Ω–æ—à–µ–Ω–∏–µ —Å—Ç–æ—Ä–æ–Ω.\n\n"
        "üìå –ï—Å–ª–∏ –¥–µ–ª–∏–º –±–æÃÅ–ª—å—à—É—é —Å—Ç–æ—Ä–æ–Ω—É –Ω–∞ –º–µÃÅ–Ω—å—à—É—é ‚Üí –≤—Å–µ–≥–¥–∞ –ø–æ–ª—É—á–∞–µ–º –ø—Ä–∏–º–µ—Ä–Ω–æ <b>1,4</b>.\n"
        "üìå –ï—Å–ª–∏ –¥–µ–ª–∏–º –º–µÃÅ–Ω—å—à—É—é —Å—Ç–æ—Ä–æ–Ω—É –Ω–∞ –±–æÃÅ–ª—å—à—É—é ‚Üí –≤—Å–µ–≥–¥–∞ –ø–æ–ª—É—á–∞–µ–º –ø—Ä–∏–º–µ—Ä–Ω–æ <b>0,7</b>.\n\n"
        "–ù—É–∂–Ω–æ —Ç–æ–ª—å–∫–æ –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å, –∫–∞–∫–æ–π –ø–æ—Ä—è–¥–æ–∫ –¥–µ–ª–µ–Ω–∏—è —Ç—Ä–µ–±—É–µ—Ç—Å—è –≤ —É—Å–ª–æ–≤–∏–∏.",

    "find_diagonal_ratio":
        "–í—Å–µ —Ñ–æ—Ä–º–∞—Ç—ã —Å–µ—Ä–∏–∏ A –∏–º–µ—é—Ç –æ–¥–∏–Ω–∞–∫–æ–≤–æ–µ —Å–æ–æ—Ç–Ω–æ—à–µ–Ω–∏–µ —Å—Ç–æ—Ä–æ–Ω.\n"
        "–ü–æ—ç—Ç–æ–º—É –æ—Ç–Ω–æ—à–µ–Ω–∏–µ –¥–∏–∞–≥–æ–Ω–∞–ª–∏ –∫ —Å—Ç–æ—Ä–æ–Ω–µ –Ω–µ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –Ω–æ–º–µ—Ä–∞ —Ñ–æ—Ä–º–∞—Ç–∞.\n\n"
        "–û–Ω–æ –≤—Å–µ–≥–¥–∞ –æ–¥–∏–Ω–∞–∫–æ–≤–æ–µ:\n\n"
        "üîπ –¥–∏–∞–≥–æ–Ω–∞–ª—å –∫ –º–µÃÅ–Ω—å—à–µ–π —Å—Ç–æ—Ä–æ–Ω–µ ‚âà <b>1,7</b>\n"
        "üîπ –¥–∏–∞–≥–æ–Ω–∞–ª—å –∫ –±–æÃÅ–ª—å—à–µ–π —Å—Ç–æ—Ä–æ–Ω–µ ‚âà <b>1,2</b>",

    "find_with_rounding":
        "–°–Ω–∞—á–∞–ª–∞ –Ω–∞—Ö–æ–¥–∏–º —á–∏—Å–ª–æ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –¥–ª–∏–Ω—ã –∏–ª–∏ —à–∏—Ä–∏–Ω—ã –≤ —Ç–∞–±–ª–∏—Ü–µ.\n"
        "–ó–∞—Ç–µ–º –æ–∫—Ä—É–≥–ª—è–µ–º –µ–≥–æ –¥–æ –±–ª–∏–∂–∞–π—à–µ–≥–æ —á–∏—Å–ª–∞,\n"
        "–∫–æ—Ç–æ—Ä–æ–µ –¥–µ–ª–∏—Ç—Å—è –Ω–∞ —É–∫–∞–∑–∞–Ω–Ω–æ–µ –≤ —É—Å–ª–æ–≤–∏–∏ —á–∏—Å–ª–æ \n"
        "(–Ω–∞–ø—Ä–∏–º–µ—Ä, –Ω–∞ 10 –∏–ª–∏ –Ω–∞ 5).\n",

    # ------------------------------------------------------------------
    # üü™ –í–û–ü–†–û–° 4 (–ü—Ä–∏–∫–ª–∞–¥–Ω–∞—è –∑–∞–¥–∞—á–∞: –ø–ª–æ—â–∞–¥—å –ª–∏—Å—Ç–∞)
    ## –ü–∞—Ç—Ç–µ—Ä–Ω paper_area
    # ------------------------------------------------------------------

    "area_basic":
        "–ü–ª–æ—â–∞–¥—å –ø—Ä—è–º–æ—É–≥–æ–ª—å–Ω–æ–≥–æ –ª–∏—Å—Ç–∞ (–ø—Ä—è–º–æ—É–≥–æ–ª—å–Ω–∏–∫–∞)\n"
        "—Ä–∞–≤–Ω–∞ <b>–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—é –¥–ª–∏–Ω—ã –Ω–∞ —à–∏—Ä–∏–Ω—É</b>.\n\n"
        "–†–∞–∑–º–µ—Ä—ã –≤ —Ç–∞–±–ª–∏—Ü–µ –¥–∞–Ω—ã –≤ –º–∏–ª–ª–∏–º–µ—Ç—Ä–∞—Ö,\n"
        "–∞ –æ—Ç–≤–µ—Ç —Ç—Ä–µ–±—É–µ—Ç—Å—è –≤ –∫–≤–∞–¥—Ä–∞—Ç–Ω—ã—Ö —Å–∞–Ω—Ç–∏–º–µ—Ç—Ä–∞—Ö.",

    "area_with_rounding_10":
        "–ü–ª–æ—â–∞–¥—å –ø—Ä—è–º–æ—É–≥–æ–ª—å–Ω–æ–≥–æ –ª–∏—Å—Ç–∞ (–ø—Ä—è–º–æ—É–≥–æ–ª—å–Ω–∏–∫–∞)\n"
        "—Ä–∞–≤–Ω–∞ <b>–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—é –¥–ª–∏–Ω—ã –Ω–∞ —à–∏—Ä–∏–Ω—É</b>.\n\n"
        "–†–∞–∑–º–µ—Ä—ã –≤ —Ç–∞–±–ª–∏—Ü–µ –¥–∞–Ω—ã –≤ –º–∏–ª–ª–∏–º–µ—Ç—Ä–∞—Ö,\n"
        "–∞ –æ—Ç–≤–µ—Ç –Ω—É–∂–µ–Ω –≤ –∫–≤–∞–¥—Ä–∞—Ç–Ω—ã—Ö —Å–∞–Ω—Ç–∏–º–µ—Ç—Ä–∞—Ö.\n\n"
        "–ü–æ—ç—Ç–æ–º—É:\n"
        "1Ô∏è‚É£ –ø–µ—Ä–µ–≤–æ–¥–∏–º –º–∏–ª–ª–∏–º–µ—Ç—Ä—ã –≤ —Å–∞–Ω—Ç–∏–º–µ—Ç—Ä—ã,\n"
        "2Ô∏è‚É£ –≤—ã—á–∏—Å–ª—è–µ–º –ø–ª–æ—â–∞–¥—å,\n"
        "3Ô∏è‚É£ –æ–∫—Ä—É–≥–ª—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç –¥–æ –±–ª–∏–∂–∞–π—à–µ–≥–æ —á–∏—Å–ª–∞,\n"
        "–∫–æ—Ç–æ—Ä–æ–µ –¥–µ–ª–∏—Ç—Å—è –Ω–∞ 10.",

    "area_with_rounding_5":
        "–ü–ª–æ—â–∞–¥—å –ø—Ä—è–º–æ—É–≥–æ–ª—å–Ω–∏–∫–∞ —Ä–∞–≤–Ω–∞:\n\n"
        "<b>S = –¥–ª–∏–Ω–∞ √ó —à–∏—Ä–∏–Ω–∞</b>\n\n"
        "–†–∞–∑–º–µ—Ä—ã –≤ —Ç–∞–±–ª–∏—Ü–µ –¥–∞–Ω—ã –≤ –º–∏–ª–ª–∏–º–µ—Ç—Ä–∞—Ö,\n"
        "–∞ –æ—Ç–≤–µ—Ç –Ω—É–∂–µ–Ω –≤ –∫–≤–∞–¥—Ä–∞—Ç–Ω—ã—Ö —Å–∞–Ω—Ç–∏–º–µ—Ç—Ä–∞—Ö.\n\n"
        "–ü–æ—ç—Ç–æ–º—É:\n"
        "1Ô∏è‚É£ –ø–µ—Ä–µ–≤–æ–¥–∏–º –º–∏–ª–ª–∏–º–µ—Ç—Ä—ã –≤ —Å–∞–Ω—Ç–∏–º–µ—Ç—Ä—ã,\n"
        "2Ô∏è‚É£ –≤—ã—á–∏—Å–ª—è–µ–º –ø–ª–æ—â–∞–¥—å,\n"
        "3Ô∏è‚É£ –æ–∫—Ä—É–≥–ª—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç –¥–æ –±–ª–∏–∂–∞–π—à–µ–≥–æ —á–∏—Å–ª–∞,\n"
        "–∫–æ—Ç–æ—Ä–æ–µ –¥–µ–ª–∏—Ç—Å—è –Ω–∞ 5.",

    # ------------------------------------------------------------------
    # üü´ –í–û–ü–†–û–° 5 (–ü—Ä–∏–∫–ª–∞–¥–Ω–∞—è –∑–∞–¥–∞—á–∞: –º–∞—Å—Å–∞)
    ## –ü–∞—Ç—Ç–µ—Ä–Ω paper_pack_weight
    # ------------------------------------------------------------------

    "pack_weight":
        "1Ô∏è‚É£ –ü–ª–æ—â–∞–¥—å –ª–∏—Å—Ç–∞ —Ñ–æ—Ä–º–∞—Ç–∞ A0 —Ä–∞–≤–Ω–∞ 1 –º¬≤.\n"
        "2Ô∏è‚É£ –ú–∞—Å—Å–∞ –æ–¥–Ω–æ–≥–æ –ª–∏—Å—Ç–∞ –ø—Ä–æ–ø–æ—Ä—Ü–∏–æ–Ω–∞–ª—å–Ω–∞ –µ–≥–æ –ø–ª–æ—â–∞–¥–∏.\n"
        "–°–Ω–∞—á–∞–ª–∞ –Ω—É–∂–Ω–æ –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å, —Å–∫–æ–ª—å–∫–æ –ª–∏—Å—Ç–æ–≤ –¥–∞–Ω–Ω–æ–≥–æ —Ñ–æ—Ä–º–∞—Ç–∞ –ø–æ–º–µ—â–∞–µ—Ç—Å—è –≤ 1 –º¬≤,\n"
        "–∑–∞—Ç–µ–º –Ω–∞–π—Ç–∏ –º–∞—Å—Å—É –æ–¥–Ω–æ–≥–æ –ª–∏—Å—Ç–∞ –∏ —É–º–Ω–æ–∂–∏—Ç—å –Ω–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ª–∏—Å—Ç–æ–≤ –≤ –ø–∞—á–∫–µ.",

    # ------------------------------------------------------------------
    # üüß –í–û–ü–†–û–° 6 (–ü—Ä–∏–∫–ª–∞–¥–Ω–∞—è –∑–∞–¥–∞—á–∞: –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ)
    ## –ü–∞—Ç—Ç–µ—Ä–Ω paper_font_scaling
    # ------------------------------------------------------------------

    "font_scaling":
        "–õ–∏—Å—Ç—ã —Å–µ—Ä–∏–∏ A –ø–æ–¥–æ–±–Ω—ã –¥—Ä—É–≥ –¥—Ä—É–≥—É.\n"
        "–ü—Ä–∏ –ø–µ—Ä–µ—Ö–æ–¥–µ –∫ —Å–æ—Å–µ–¥–Ω–µ–º—É —Ñ–æ—Ä–º–∞—Ç—É –ª–∏–Ω–µ–π–Ω—ã–µ —Ä–∞–∑–º–µ—Ä—ã –º–µ–Ω—è—é—Ç—Å—è —Å –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–æ–º\n\n"
        "<b>‚àö2 ‚âà 1,41</b>\n\n"
        "–ü—Ä–∞–≤–∏–ª–æ:\n\n"
        "üìà –õ–∏—Å—Ç —Å—Ç–∞–ª –±–æ–ª—å—à–µ –Ω–∞ 1 ‚Üí —à—Ä–∏—Ñ—Ç —É–º–Ω–æ–∂–∞–µ–º –Ω–∞ 1,4.\n"
        "üìâ –õ–∏—Å—Ç —Å—Ç–∞–ª –º–µ–Ω—å—à–µ –Ω–∞ 1 ‚Üí —à—Ä–∏—Ñ—Ç –¥–µ–ª–∏–º –Ω–∞ 1,4 (–∏–ª–∏ —É–º–Ω–æ–∂–∞–µ–º –Ω–∞ 0,7)."
}


STEP_TEMPLATES: Dict[str, str] = {

    # ------------------------------------------------------------------
    # üü© –í–û–ü–†–û–° 1 (–ó–∞–¥–∞—á–∞ –Ω–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ)
    ## –ü–∞—Ç—Ç–µ—Ä–Ω paper_format_match
    # ------------------------------------------------------------------

    # --- 1Ô∏è‚É£ match_formats_to_rows ---
    "STEP_MATCH_COMPARE": (
        "<b>–®–∞–≥ 1.</b> –°—Ä–∞–≤–Ω–∏–º –∑–Ω–∞—á–µ–Ω–∏—è –¥–ª–∏–Ω –∏ –æ–ø—Ä–µ–¥–µ–ª–∏–º —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Ñ–æ—Ä–º–∞—Ç–æ–≤.\n"
        "–ü–æ–º–Ω–∏–º –ø—Ä–∞–≤–∏–ª–æ: <b>—á–µ–º –º–µ–Ω—å—à–µ –Ω–æ–º–µ—Ä —Ñ–æ—Ä–º–∞—Ç–∞, —Ç–µ–º –±–æ–ª—å—à–µ –ª–∏—Å—Ç</b>.\n\n"
        "‚û°Ô∏è <b>—Å—Ç—Ä–æ–∫–∞ {row_1}: –¥–ª–∏–Ω–∞ = {len_1} ‚Äî —Å–∞–º–æ–µ –±–æ–ª—å—à–æ–µ —á–∏—Å–ª–æ ‚Üí {format_1}</b>\n\n"
        "‚û°Ô∏è <b>—Å—Ç—Ä–æ–∫–∞ {row_2}: –¥–ª–∏–Ω–∞ = {len_2} ‚Äî —Å–ª–µ–¥—É—é—â–µ–µ –ø–æ –≤–µ–ª–∏—á–∏–Ω–µ ‚Üí {format_2}</b>\n\n"
        "‚û°Ô∏è <b>—Å—Ç—Ä–æ–∫–∞ {row_3}: –¥–ª–∏–Ω–∞ = {len_3} ‚Üí {format_3}</b>\n\n"
        "‚û°Ô∏è <b>—Å—Ç—Ä–æ–∫–∞ {row_4}: –¥–ª–∏–Ω–∞ = {len_4} ‚Äî —Å–∞–º–æ–µ –º–∞–ª–µ–Ω—å–∫–æ–µ —á–∏—Å–ª–æ ‚Üí {format_4}</b>"
    ),

    "STEP_MATCH_SEQUENCE": (
        "<b>–®–∞–≥ 2.</b> –ù–∞—Å –ø—Ä–æ—Å—è—Ç –∑–∞–ø–∏—Å–∞—Ç—å –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –¥–ª—è \n"
        "<b>{requested_order}</b>\n\n"
        "‚û°Ô∏è <b>{answer_sequence}</b>"
    ),

    # ------------------------------------------------------------------
    # üü® –í–û–ü–†–û–° 2 (–ó–∞–¥–∞—á–∞ –Ω–∞ —Ä–∞–∑—Ä–µ–∑–∞–Ω–∏–µ)
    ## –ü–∞—Ç—Ç–µ—Ä–Ω paper_split
    # ------------------------------------------------------------------

    # --- 1Ô∏è‚É£ count_subformats ---
    "STEP_SPLIT_DIFF": (
        "<b>–®–∞–≥ 1.</b> –ù–∞—Ö–æ–¥–∏–º —Ä–∞–∑–Ω–∏—Ü—É –Ω–æ–º–µ—Ä–æ–≤ —Ñ–æ—Ä–º–∞—Ç–æ–≤.\n"
        "–ë–æ–ª—å—à–∏–π –ª–∏—Å—Ç ‚Äî {from_format}, –º–µ–Ω—å—à–∏–π ‚Äî {to_format}.\n\n"
        "‚û°Ô∏è <b>{to_index} ‚àí {from_index} = {index_difference}</b>\n\n"
        "–ó–Ω–∞—á–∏—Ç, –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å {index_difference} –ø–µ—Ä–µ—Ö–æ–¥–∞.\n\n"
        "‚û°Ô∏è <b>{transition_chain}</b>"
    ),

    "STEP_SPLIT_POWER": (
        "<b>–®–∞–≥ 2.</b> –ö–∞–∂–¥—ã–π –ø–µ—Ä–µ—Ö–æ–¥ —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ª–∏—Å—Ç–æ–≤ –≤ 2 —Ä–∞–∑–∞:\n\n"
        "‚û°Ô∏è <b>{doubling_chain}</b>\n\n"
        "–°–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ,\n\n"
        "‚û°Ô∏è <b>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ª–∏—Å—Ç–æ–≤ = 2{sup_power}</b>\n"
        "‚û°Ô∏è <b>2{sup_power} = {power_value}</b>"
    ),
    # ------------------------------------------------------------------
    # üü• –í–û–ü–†–û–° 3 (–ü—Ä–∏–∫–ª–∞–¥–Ω–∞—è –∑–∞–¥–∞—á–∞: –Ω–∞–π—Ç–∏ –¥–ª–∏–Ω—É, —à–∏—Ä–∏–Ω—É, —Å–æ–æ—Ç–Ω–æ—à–µ–Ω–∏—è —ç—Ç–∏—Ö –≤–µ–ª–∏—á–∏–Ω)
    ## –ü–∞—Ç—Ç–µ—Ä–Ω paper_dimensions
    # ------------------------------------------------------------------

    # --- 1Ô∏è‚É£ find_length ---
    "STEP_DIM_LENGTH": (
        "<b>–®–∞–≥ 1.</b> –ò–∑ –∑–∞–¥–∞–Ω–∏—è 1 –∏–∑–≤–µ—Å—Ç–Ω–æ,\n"
        "—á—Ç–æ —Ñ–æ—Ä–º–∞—Ç—É <b>{format}</b> —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –ª–∏—Å—Ç <b>‚Ññ{row_number}</b>.\n\n"
        "–í —Ç–∞–±–ª–∏—Ü–µ –¥–ª—è —ç—Ç–æ–≥–æ –Ω–æ–º–µ—Ä–∞ —É–∫–∞–∑–∞–Ω–æ:\n"
        "‚û°Ô∏è <b>–î–ª–∏–Ω–∞ ‚Äî {selected_value} –º–º</b>"
    ),

    # --- 2Ô∏è‚É£ find_width ---
    "STEP_DIM_WIDTH": (
        "<b>–®–∞–≥ 1.</b> –ò–∑ –∑–∞–¥–∞–Ω–∏—è 1 –∏–∑–≤–µ—Å—Ç–Ω–æ,\n"
        "—á—Ç–æ —Ñ–æ—Ä–º–∞—Ç—É <b>{format}</b> —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –ª–∏—Å—Ç <b>‚Ññ{row_number}</b>.\n\n"
        "–í —Ç–∞–±–ª–∏—Ü–µ –¥–ª—è —ç—Ç–æ–≥–æ –Ω–æ–º–µ—Ä–∞ —É–∫–∞–∑–∞–Ω–æ:\n"
        "‚û°Ô∏è <b>–®–∏—Ä–∏–Ω–∞ ‚Äî {selected_value} –º–º</b>"
    ),

    # --- 3Ô∏è‚É£ find_side ---
    "STEP_DIM_SIDE_GIVEN": (
        "<b>–®–∞–≥ 1.</b> –ü–æ –∑–∞–¥–∞–Ω–∏—é 1 –º—ã –æ–ø—Ä–µ–¥–µ–ª–∏–ª–∏,\n"
        "—á—Ç–æ —Ñ–æ—Ä–º–∞—Ç—É <b>{format}</b> —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –ª–∏—Å—Ç ‚Ññ<b>{row_number}</b>.\n\n"
        "–í —Ç–∞–±–ª–∏—Ü–µ —É–∫–∞–∑–∞–Ω–æ:\n"
        "‚û°Ô∏è –î–ª–∏–Ω–∞ ‚Äî {length_mm} –º–º\n"
        "‚û°Ô∏è –®–∏—Ä–∏–Ω–∞ ‚Äî {width_mm} –º–º"
    ),

    "STEP_DIM_SIDE_COMPARE": (
        "<b>–®–∞–≥ 2.</b>\n"
        "‚û°Ô∏è <b>{comparison_expression}</b>"
    ),

    # --- 4Ô∏è‚É£ find_ratio ---
    "STEP_RATIO_ORDER": (
        "<b>–®–∞–≥ 1.</b> –û–ø—Ä–µ–¥–µ–ª—è–µ–º, —á—Ç–æ —Ç—Ä–µ–±—É–µ—Ç –∑–∞–¥–∞—á–∞:\n\n"
        "üîπ {division_order}"
    ),

    "STEP_RATIO_CALC": (
        "<b>–®–∞–≥ 2.</b> –ó–∞–ø–∏—Å—ã–≤–∞–µ–º –≥–æ—Ç–æ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ:\n\n"
        "‚û°Ô∏è {division_expression} ‚âà <b>{raw_ratio}</b>\n\n"
        "–û–∫—Ä—É–≥–ª—è–µ–º –¥–æ –¥–µ—Å—è—Ç—ã—Ö –∏ –ø–æ–ª—É—á–∞–µ–º <b>{rounded_ratio}</b>"
    ),

    # --- 5Ô∏è‚É£ find_diagonal_ratio ---
    "STEP_DIAG_ORDER": (
        "<b>–®–∞–≥ 1.</b> –û–ø—Ä–µ–¥–µ–ª—è–µ–º, –∫–∞–∫—É—é —Å—Ç–æ—Ä–æ–Ω—É –Ω—É–∂–Ω–æ –≤–∑—è—Ç—å –ø–æ —É—Å–ª–æ–≤–∏—é:\n"
        "‚û°Ô∏è <b>{side_type}</b>"
    ),

    "STEP_DIAG_RATIO": (
        "<b>–®–∞–≥ 2.</b> –ò—Å–ø–æ–ª—å–∑—É–µ–º –ø–æ—Å—Ç–æ—è–Ω–Ω–æ–µ —Å–æ–æ—Ç–Ω–æ—à–µ–Ω–∏–µ:\n\n"
        "‚û°Ô∏è –¥–∏–∞–≥–æ–Ω–∞–ª—å –∫ {side_type} —Å—Ç–æ—Ä–æ–Ω–µ = <b>{ratio_value}</b>"
    ),

    # --- 6Ô∏è‚É£ find_with_rounding ---
    "STEP_ROUND_GIVEN": (
        "<b>–®–∞–≥ 1.</b> –ò–∑ –∑–∞–¥–∞–Ω–∏—è 1 –∏–∑–≤–µ—Å—Ç–Ω–æ,\n"
        "—á—Ç–æ —Ñ–æ—Ä–º–∞—Ç—É <b>{format}</b> —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –ª–∏—Å—Ç <b>‚Ññ{row_number}</b>.\n\n"
        "–í —Ç–∞–±–ª–∏—Ü–µ –¥–ª—è —ç—Ç–æ–≥–æ –Ω–æ–º–µ—Ä–∞ —É–∫–∞–∑–∞–Ω–æ:\n"
        "‚û°Ô∏è <b>{side_name} ‚Äî {original_value} –º–º</b>"
    ),

    "STEP_ROUND_PROCESS_MIDDLE": (
        "<b>–®–∞–≥ 2.</b> –û–∫—Ä—É–≥–ª—è–µ–º <b>{original_value}</b> –¥–æ –±–ª–∏–∂–∞–π—à–µ–≥–æ —á–∏—Å–ª–∞, –∫—Ä–∞—Ç–Ω–æ–≥–æ <b>{round_base}</b>.\n\n"
        "–ë–ª–∏–∂–∞–π—à–∏–µ –∫—Ä–∞—Ç–Ω—ã–µ <b>{round_base}</b> —á–∏—Å–ª–∞:\n"
        "‚û°Ô∏è <b>{lower_value} –∏ {upper_value}</b>\n\n"
        "<b>{original_value}</b> –Ω–∞—Ö–æ–¥–∏—Ç—Å—è —Ä–æ–≤–Ω–æ –ø–æ—Å–µ—Ä–µ–¥–∏–Ω–µ.\n"
        "–ü–æ –ø—Ä–∞–≤–∏–ª—É –æ–∫—Ä—É–≥–ª–µ–Ω–∏—è —á–∏—Å–ª–æ <b>5</b> –æ–∫—Ä—É–≥–ª—è–µ–º –≤ –±–æ–ª—å—à—É—é —Å—Ç–æ—Ä–æ–Ω—É.\n\n"
        "‚û°Ô∏è <b>{original_value} ‚Üí {rounded_value}</b>"
    ),

    "STEP_ROUND_PROCESS_NORMAL": (
        "<b>–®–∞–≥ 2.</b> –û–∫—Ä—É–≥–ª—è–µ–º <b>{original_value}</b> –¥–æ –±–ª–∏–∂–∞–π—à–µ–≥–æ —á–∏—Å–ª–∞, –∫—Ä–∞—Ç–Ω–æ–≥–æ <b>{round_base}</b>.\n\n"
        "–ë–ª–∏–∂–∞–π—à–∏–µ –∫—Ä–∞—Ç–Ω—ã–µ <b>{round_base}</b> —á–∏—Å–ª–∞:\n"
        "‚û°Ô∏è <b>{lower_value} –∏ {upper_value}</b>\n\n"
        "<b>{original_value}</b> –±–ª–∏–∂–µ –∫ <b>{rounded_value}</b>.\n\n"
        "‚û°Ô∏è <b>{original_value} ‚Üí {rounded_value}</b>"
    ),

    "STEP_ROUND_PROCESS_EXACT": (
        "<b>–®–∞–≥ 2.</b> –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫—Ä–∞—Ç–Ω–æ—Å—Ç—å <b>{round_base}</b>.\n\n"
        "<b>{original_value}</b> —É–∂–µ –¥–µ–ª–∏—Ç—Å—è –Ω–∞ <b>{round_base}</b> –±–µ–∑ –æ—Å—Ç–∞—Ç–∫–∞.\n"
        "‚û°Ô∏è <b>–û–∫—Ä—É–≥–ª–µ–Ω–∏–µ –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è</b>\n\n"
        "‚û°Ô∏è <b>{original_value} ‚Üí {rounded_value}</b>"
    ),

    # ------------------------------------------------------------------
    # üü™ –í–û–ü–†–û–° 4 (–ü—Ä–∏–∫–ª–∞–¥–Ω–∞—è –∑–∞–¥–∞—á–∞: –ø–ª–æ—â–∞–¥—å –ª–∏—Å—Ç–∞)
    ## –ü–∞—Ç—Ç–µ—Ä–Ω paper_area
    # ------------------------------------------------------------------

    # --- 1Ô∏è‚É£ area_basic ---
    "STEP_AREA_BASIC_SIZES": (
        "<b>–®–∞–≥ 1.</b> –í —Ç–∞–±–ª–∏—Ü–µ –Ω–∞—Ö–æ–¥–∏–º —Ä–∞–∑–º–µ—Ä—ã —Ñ–æ—Ä–º–∞—Ç–∞ <b>{format}</b>:\n"
        "‚û°Ô∏è <b>–î–ª–∏–Ω–∞ ‚Äî {length_mm} –º–º</b>\n"
        "‚û°Ô∏è <b>–®–∏—Ä–∏–Ω–∞ ‚Äî {width_mm} –º–º</b>\n\n"
        "–ü–µ—Ä–µ–≤–æ–¥–∏–º –≤ —Å–∞–Ω—Ç–∏–º–µ—Ç—Ä—ã:\n"
        "1 —Å–º = 10 –º–º, –∑–Ω–∞—á–∏—Ç –¥–µ–ª–∏–º –Ω–∞ 10.\n\n"
        "‚û°Ô∏è <b>{length_mm} –º–º = {length_cm} —Å–º</b>\n"
        "‚û°Ô∏è <b>{width_mm} –º–º = {width_cm} —Å–º</b>"
    ),

    "STEP_AREA_BASIC_CALC": (
        "<b>–®–∞–≥ 2.</b> –í—ã—á–∏—Å–ª—è–µ–º –ø–ª–æ—â–∞–¥—å:\n"
        "‚û°Ô∏è <b>S = {length_cm} ¬∑ {width_cm} = {area_raw} —Å–º¬≤</b>"
    ),

    # --- 2Ô∏è‚É£ area_with_rounding_10 ---
    "STEP_AREA_R10_SIZES": (
        "<b>–®–∞–≥ 1.</b> –í —Ç–∞–±–ª–∏—Ü–µ –Ω–∞—Ö–æ–¥–∏–º —Ä–∞–∑–º–µ—Ä—ã –ª–∏—Å—Ç–∞ <b>{format}</b>:\n"
        "‚û°Ô∏è <b>–î–ª–∏–Ω–∞ ‚Äî {length_mm} –º–º</b>\n"
        "‚û°Ô∏è <b>–®–∏—Ä–∏–Ω–∞ ‚Äî {width_mm} –º–º</b>\n\n"
        "–ü–µ—Ä–µ–≤–æ–¥–∏–º –≤ —Å–∞–Ω—Ç–∏–º–µ—Ç—Ä—ã:\n"
        "1 —Å–º = 10 –º–º, –∑–Ω–∞—á–∏—Ç –¥–µ–ª–∏–º –Ω–∞ 10.\n\n"
        "‚û°Ô∏è <b>{length_mm} –º–º = {length_cm} —Å–º</b>\n"
        "‚û°Ô∏è <b>{width_mm} –º–º = {width_cm} —Å–º</b>"
    ),

    "STEP_AREA_R10_CALC": (
        "<b>–®–∞–≥ 2.</b> –í—ã—á–∏—Å–ª—è–µ–º –ø–ª–æ—â–∞–¥—å:\n"
        "‚û°Ô∏è <b>S = {length_cm} ¬∑ {width_cm} = {area_raw} —Å–º¬≤</b>"
    ),

    "STEP_AREA_R10_ROUND": (
        "<b>–®–∞–≥ 3.</b> –û–∫—Ä—É–≥–ª—è–µ–º –¥–æ –±–ª–∏–∂–∞–π—à–µ–≥–æ —á–∏—Å–ª–∞, –∫—Ä–∞—Ç–Ω–æ–≥–æ <b>{round_base}</b>.\n\n"
        "–ë–ª–∏–∂–∞–π—à–∏–µ –¥–µ—Å—è—Ç–∫–∏: <b>{lower_value} –∏ {upper_value}</b>.\n"
        "<b>{area_raw}</b> –±–ª–∏–∂–µ –∫ <b>{rounded_area}</b>.\n\n"
        "‚û°Ô∏è <b>–û–∫—Ä—É–≥–ª—ë–Ω–Ω–∞—è –ø–ª–æ—â–∞–¥—å = {rounded_area} —Å–º¬≤</b>"
    ),

    # --- 3Ô∏è‚É£ area_with_rounding_5 ---
    "STEP_AREA_R5_SIZES": (
        "<b>–®–∞–≥ 1.</b> –í —Ç–∞–±–ª–∏—Ü–µ –Ω–∞—Ö–æ–¥–∏–º —Ä–∞–∑–º–µ—Ä—ã –ª–∏—Å—Ç–∞ <b>{format}</b>:\n"
        "‚û°Ô∏è <b>–î–ª–∏–Ω–∞ ‚Äî {length_mm} –º–º</b>\n"
        "‚û°Ô∏è <b>–®–∏—Ä–∏–Ω–∞ ‚Äî {width_mm} –º–º</b>\n\n"
        "–ü–µ—Ä–µ–≤–æ–¥–∏–º –≤ —Å–∞–Ω—Ç–∏–º–µ—Ç—Ä—ã:\n"
        "1 —Å–º = 10 –º–º, –∑–Ω–∞—á–∏—Ç –¥–µ–ª–∏–º –Ω–∞ 10.\n\n"
        "‚û°Ô∏è <b>{length_mm} –º–º = {length_cm} —Å–º</b>\n"
        "‚û°Ô∏è <b>{width_mm} –º–º = {width_cm} —Å–º</b>"
    ),

    "STEP_AREA_R5_CALC": (
        "<b>–®–∞–≥ 2.</b> –í—ã—á–∏—Å–ª—è–µ–º –ø–ª–æ—â–∞–¥—å:\n"
        "‚û°Ô∏è <b>S = {length_cm} ¬∑ {width_cm} = {area_raw} —Å–º¬≤</b>"
    ),

    "STEP_AREA_R5_ROUND": (
        "<b>–®–∞–≥ 3.</b> –û–∫—Ä—É–≥–ª—è–µ–º –¥–æ –±–ª–∏–∂–∞–π—à–µ–≥–æ —á–∏—Å–ª–∞, –∫—Ä–∞—Ç–Ω–æ–≥–æ <b>{round_base}</b>.\n\n"
        "–ë–ª–∏–∂–∞–π—à–∏–µ –∫—Ä–∞—Ç–Ω—ã–µ 5 —á–∏—Å–ª–∞: <b>{lower_value} –∏ {upper_value}</b>.\n"
        "‚û°Ô∏è <b>{area_raw} –±–ª–∏–∂–µ –∫ {rounded_area}</b>.\n\n"
        "‚û°Ô∏è <b>–û–∫—Ä—É–≥–ª—ë–Ω–Ω–∞—è –ø–ª–æ—â–∞–¥—å = {rounded_area} —Å–º¬≤</b>"
    ),

    # ------------------------------------------------------------------
    # üü´ –í–û–ü–†–û–° 5 (–ü—Ä–∏–∫–ª–∞–¥–Ω–∞—è –∑–∞–¥–∞—á–∞: –º–∞—Å—Å–∞)
    ## –ü–∞—Ç—Ç–µ—Ä–Ω paper_pack_weight
    # ------------------------------------------------------------------

    # --- 1Ô∏è‚É£ pack_weight ---
    "STEP_PACK_COUNT": (
        "<b>–®–∞–≥ 1.</b> –û–ø—Ä–µ–¥–µ–ª—è–µ–º, —Å–∫–æ–ª—å–∫–æ –ª–∏—Å—Ç–æ–≤ {to_format} –ø–æ–ª—É—á–∞–µ—Ç—Å—è –∏–∑ {from_format}.\n\n"
        "–†–∞–∑–Ω–∏—Ü–∞ –Ω–æ–º–µ—Ä–æ–≤ —Ñ–æ—Ä–º–∞—Ç–æ–≤:\n"
        "‚û°Ô∏è <b>{to_index} ‚àí {from_index} = {index_difference}</b>\n\n"
        "–°–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ,\n\n"
        "‚û°Ô∏è <b>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ª–∏—Å—Ç–æ–≤ = 2{sup_power}</b>\n"
        "‚û°Ô∏è <b>2{sup_power} = {sheet_count}</b>\n\n"
        "–ó–Ω–∞—á–∏—Ç, –∏–∑ –æ–¥–Ω–æ–≥–æ –ª–∏—Å—Ç–∞ {from_format} –ø–æ–ª—É—á–∞–µ—Ç—Å—è {sheet_count} –ª–∏—Å—Ç–∞ {to_format}."
    ),

    "STEP_PACK_SINGLE_WEIGHT": (
        "<b>–®–∞–≥ 2.</b> –ù–∞—Ö–æ–¥–∏–º –º–∞—Å—Å—É –æ–¥–Ω–æ–≥–æ –ª–∏—Å—Ç–∞ {to_format}.\n\n"
        "–ú–∞—Å—Å–∞ 1 –º¬≤ –±—É–º–∞–≥–∏ —Ä–∞–≤–Ω–∞ {mass_per_m2} –≥.\n\n"
        "‚û°Ô∏è <b>–º–∞—Å—Å–∞ –æ–¥–Ω–æ–≥–æ –ª–∏—Å—Ç–∞ = {mass_per_m2} √∑ {sheet_count} = {single_weight} –≥</b>"
    ),

    "STEP_PACK_TOTAL": (
        "<b>–®–∞–≥ 3.</b> –ù–∞—Ö–æ–¥–∏–º –º–∞—Å—Å—É –ø–∞—á–∫–∏.\n\n"
        "‚û°Ô∏è <b>{single_weight} ¬∑ {pack_size} = {total_weight} –≥</b>"
    ),

    # ------------------------------------------------------------------
    # üüß –í–û–ü–†–û–° 6 (–ü—Ä–∏–∫–ª–∞–¥–Ω–∞—è –∑–∞–¥–∞—á–∞: –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ)
    ## –ü–∞—Ç—Ç–µ—Ä–Ω paper_font_scaling
    # ------------------------------------------------------------------

    # --- 1Ô∏è‚É£ font_scaling ---

    # --- 1Ô∏è‚É£ –ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ ---
    "STEP_FONT_DIRECTION": (
        "<b>–®–∞–≥ 1.</b> –û–ø—Ä–µ–¥–µ–ª–∏–º –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–µ—Ä–µ—Ö–æ–¥–∞.\n"
        "{from_format} ‚Üí {to_format}.\n"
        "–ù–æ–º–µ—Ä —Ñ–æ—Ä–º–∞—Ç–∞ –∏–∑–º–µ–Ω–∏–ª—Å—è ({from_index} ‚Üí {to_index}), "
        "–∑–Ω–∞—á–∏—Ç –ª–∏—Å—Ç —Å—Ç–∞–ª <b>{sheet_became}</b>.\n"
        "–®—Ä–∏—Ñ—Ç –Ω—É–∂–Ω–æ <b>{font_action}</b>."
    ),

    # --- 2Ô∏è‚É£ –ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç (exact) ---
    "STEP_FONT_SCALE": (
        "<b>–®–∞–≥ 2.</b> –ù–∞—Ö–æ–¥–∏–º –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è.\n\n"
        "–†–∞–∑–Ω–∏—Ü–∞ —Ñ–æ—Ä–º–∞—Ç–æ–≤: <b>{step_count}</b>, "
        "–∑–Ω–∞—á–∏—Ç –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç = <b>{scale_formula}</b>.\n"
        "–£–ø—Ä–æ—â–∞–µ–º: <b>{scale_formula} = {scale_factor}</b>\n\n"
        "‚û°Ô∏è <b>{original_font} ¬∑ {scale_factor} = {rounded_font}</b>"
    ),

    # --- 2Ô∏è‚É£ –ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç (–ø–æ–¥—Ä–æ–±–Ω—ã–π, —Å ‚àö2) ---
    "STEP_FONT_SCALE_DETAILED": (
        "<b>–®–∞–≥ 2.</b> –ù–∞—Ö–æ–¥–∏–º –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è.\n\n"
        "–†–∞–∑–Ω–∏—Ü–∞ —Ñ–æ—Ä–º–∞—Ç–æ–≤: <b>{step_count}</b>, "
        "–∑–Ω–∞—á–∏—Ç –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç = <b>{scale_formula}</b>.\n"
        "–£–ø—Ä–æ—â–∞–µ–º: <b>{scale_formula} = {scale_factor}</b>\n\n"
        "‚û°Ô∏è <b>{original_font} ¬∑ {scale_factor} = "
        "{original_font} ¬∑ {coef_approx} = {scaled_intermediate}</b>"
    ),

    # --- 3Ô∏è‚É£ –û–∫—Ä—É–≥–ª–µ–Ω–∏–µ ---
    "STEP_FONT_ROUND": (
        "<b>–®–∞–≥ 3.</b> –û–∫—Ä—É–≥–ª—è–µ–º –¥–æ —Ü–µ–ª–æ–≥–æ —á–∏—Å–ª–∞.\n\n"
        "‚û°Ô∏è <b>{round_source} ‚Üí {rounded_font}</b>"
    ),
}


TIPS_TEMPLATES: Dict[str, str] = {

    # ------------------------------------------------------------------
    # üü© –í–û–ü–†–û–° 1 (–ó–∞–¥–∞—á–∞ –Ω–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ)
    ## –ü–∞—Ç—Ç–µ—Ä–Ω paper_format_match
    # ------------------------------------------------------------------

    "match_formats_to_rows": (
        "üìå –ß—Ç–æ–±—ã –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å —Ñ–æ—Ä–º–∞—Ç, –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–∞–≤–Ω–∏—Ç—å –æ–¥–Ω—É —Å—Ç–æ—Ä–æ–Ω—É ‚Äî –¥–ª–∏–Ω—É –∏–ª–∏ —à–∏—Ä–∏–Ω—É.\n\n"
        "–ß–µ–º –±–æ–ª—å—à–µ —ç—Ç–æ —á–∏—Å–ª–æ, —Ç–µ–º –±–æ–ª—å—à–µ –ª–∏—Å—Ç.\n\n"
        "üîπ –í —Å–µ—Ä–∏–∏ —Ñ–æ—Ä–º–∞—Ç–æ–≤ A:\n"
        "<b>A1 –±–æ–ª—å—à–µ A2, A2 –±–æ–ª—å—à–µ A3, A3 –±–æ–ª—å—à–µ A4 –∏ —Ç–∞–∫ –¥–∞–ª–µ–µ.</b>\n\n"
        "üìå –ß–µ–º –º–µ–Ω—å—à–µ –Ω–æ–º–µ—Ä —Ñ–æ—Ä–º–∞—Ç–∞ ‚Äî —Ç–µ–º –±–æ–ª—å—à–µ —Å–∞–º –ª–∏—Å—Ç."
    ),

    # ------------------------------------------------------------------
    # üü® –í–û–ü–†–û–° 2 (–ó–∞–¥–∞—á–∞ –Ω–∞ —Ä–∞–∑—Ä–µ–∑–∞–Ω–∏–µ)
    ## –ü–∞—Ç—Ç–µ—Ä–Ω paper_split
    # ------------------------------------------------------------------

    "count_subformats": (
        "üìå –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ª–∏—Å—Ç–æ–≤ = 2 –≤ —Å—Ç–µ–ø–Ω–∏ (–Ω–æ–º–µ—Ä –º–µ–Ω—å—à–µ–≥–æ —Ñ–æ—Ä–º–∞—Ç–∞ ‚àí –Ω–æ–º–µ—Ä –±–æ–ª—å—à–µ–≥–æ —Ñ–æ—Ä–º–∞—Ç–∞).\n"
        "üìå –ü—Ä–∏ —É–≤–µ–ª–∏—á–µ–Ω–∏–∏ —Ñ–æ—Ä–º–∞—Ç–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ª–∏—Å—Ç–æ–≤ —É–º–µ–Ω—å—à–∞–µ—Ç—Å—è –≤ 2 —Ä–∞–∑–∞ –Ω–∞ –∫–∞–∂–¥–æ–º —à–∞–≥–µ.\n"
        "üìå –ü–µ—Ä–µ—Ö–æ–¥—ã –º–æ–∂–Ω–æ —Å—á–∏—Ç–∞—Ç—å ¬´–ø–æ —Å—Ç—Ä–µ–ª–æ—á–∫–∞–º¬ª –∏–ª–∏ —Å—Ä–∞–∑—É —á–µ—Ä–µ–∑ —Å—Ç–µ–ø–µ–Ω—å –¥–≤–æ–π–∫–∏."
    ),

    # ------------------------------------------------------------------
    # üü• –í–û–ü–†–û–° 3 (–ü—Ä–∏–∫–ª–∞–¥–Ω–∞—è –∑–∞–¥–∞—á–∞: –Ω–∞–π—Ç–∏ –¥–ª–∏–Ω—É, —à–∏—Ä–∏–Ω—É, —Å–æ–æ—Ç–Ω–æ—à–µ–Ω–∏—è —ç—Ç–∏—Ö –≤–µ–ª–∏—á–∏–Ω)
    ## –ü–∞—Ç—Ç–µ—Ä–Ω paper_dimensions
    # ------------------------------------------------------------------

    "find_length": (
        "üìå –î–ª–∏–Ω–∞ ‚Äî —ç—Ç–æ –±–æÃÅ–ª—å—à–∞—è —Å—Ç–æ—Ä–æ–Ω–∞ –ø—Ä—è–º–æ—É–≥–æ–ª—å–Ω–æ–≥–æ –ª–∏—Å—Ç–∞.\n"
        "–°–Ω–∞—á–∞–ª–∞ –Ω–∞—Ö–æ–¥–∏–º —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Ñ–æ—Ä–º–∞—Ç–∞ –≤ —Ç–∞–±–ª–∏—Ü–µ,\n"
        "–∑–∞—Ç–µ–º –≤—ã–±–∏—Ä–∞–µ–º –Ω—É–∂–Ω—É—é —Å—Ç–æ—Ä–æ–Ω—É."
    ),

    "find_width": (
        "üìå –®–∏—Ä–∏–Ω–∞ ‚Äî —ç—Ç–æ –º–µÃÅ–Ω—å—à–∞—è —Å—Ç–æ—Ä–æ–Ω–∞ –ø—Ä—è–º–æ—É–≥–æ–ª—å–Ω–æ–≥–æ –ª–∏—Å—Ç–∞.\n"
        "–°–Ω–∞—á–∞–ª–∞ –Ω–∞—Ö–æ–¥–∏–º —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Ñ–æ—Ä–º–∞—Ç–∞ –≤ —Ç–∞–±–ª–∏—Ü–µ,\n"
        "–∑–∞—Ç–µ–º –≤—ã–±–∏—Ä–∞–µ–º –Ω—É–∂–Ω—É—é —Å—Ç–æ—Ä–æ–Ω—É."
    ),

    "find_side": (
        "üìå –ë–æÃÅ–ª—å—à–∞—è —Å—Ç–æ—Ä–æ–Ω–∞ ‚Äî —ç—Ç–æ –±–æ–ª—å—à–µ–µ —á–∏—Å–ª–æ.\n"
        "üìå –ú–µÃÅ–Ω—å—à–∞—è —Å—Ç–æ—Ä–æ–Ω–∞ ‚Äî —ç—Ç–æ –º–µ–Ω—å—à–µ–µ —á–∏—Å–ª–æ."
    ),

    "find_ratio": (
        "üìå –°–æ–æ—Ç–Ω–æ—à–µ–Ω–∏–µ —Å—Ç–æ—Ä–æ–Ω —É –≤—Å–µ—Ö —Ñ–æ—Ä–º–∞—Ç–æ–≤ —Å–µ—Ä–∏–∏ A –æ–¥–∏–Ω–∞–∫–æ–≤–æ–µ.\n"
        "üìå –î–µ–ª–∏–º –±–æÃÅ–ª—å—à—É—é —Å—Ç–æ—Ä–æ–Ω—É –Ω–∞ –º–µÃÅ–Ω—å—à—É—é ‚Üí –≤—Å–µ–≥–¥–∞ –ø–æ–ª—É—á–∞–µ–º –ø—Ä–∏–º–µ—Ä–Ω–æ 1,4.\n"
        "üìå –î–µ–ª–∏–º –º–µÃÅ–Ω—å—à—É—é —Å—Ç–æ—Ä–æ–Ω—É –Ω–∞ –±–æÃÅ–ª—å—à—É—é ‚Üí –≤—Å–µ–≥–¥–∞ –ø–æ–ª—É—á–∞–µ–º –ø—Ä–∏–º–µ—Ä–Ω–æ 0,7.\n"
        "üìå –ü–æ—ç—Ç–æ–º—É —á–∏—Å–ª–æ –Ω–µ –Ω—É–∂–Ω–æ –∫–∞–∂–¥—ã–π —Ä–∞–∑ –ø–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞—Ç—å ‚Äî \n"
        "–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∑–∞–ø–æ–º–Ω–∏—Ç—å —ç—Ç–∏ –¥–≤–∞ –ø—Ä–∏–±–ª–∏–∂—ë–Ω–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏—è."
    ),

    "find_diagonal_ratio": (
        "üìå –ù–µ –Ω—É–∂–Ω–æ —Å—á–∏—Ç–∞—Ç—å –±–æ–ª—å—à–∏–µ —á–∏—Å–ª–∞ –ø–æ —Ç–µ–æ—Ä–µ–º–µ –ü–∏—Ñ–∞–≥–æ—Ä–∞ ‚Äî \n"
        "–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∑–Ω–∞—Ç—å —ç—Ç–æ –ø–æ—Å—Ç–æ—è–Ω–Ω–æ–µ —Å–æ–æ—Ç–Ω–æ—à–µ–Ω–∏–µ:\n\n"
        "üëâ –î–∏–∞–≥–æ–Ω–∞–ª—å –∫ –º–µÃÅ–Ω—å—à–µ–π —Å—Ç–æ—Ä–æ–Ω–µ ‚âà 1,7.\n"
        "üëâ –î–∏–∞–≥–æ–Ω–∞–ª—å –∫ –±–æÃÅ–ª—å—à–µ–π —Å—Ç–æ—Ä–æ–Ω–µ ‚âà 1,2."
    ),

    "find_with_rounding": (
        "üìå –ö—Ä–∞—Ç–Ω—ã–µ 10 ‚Äî —ç—Ç–æ —á–∏—Å–ª–∞, –∫–æ—Ç–æ—Ä—ã–µ –æ–∫–∞–Ω—á–∏–≤–∞—é—Ç—Å—è –Ω–∞ 0.\n"
        "üìå –ö—Ä–∞—Ç–Ω—ã–µ 5 ‚Äî —ç—Ç–æ —á–∏—Å–ª–∞, –∫–æ—Ç–æ—Ä—ã–µ –æ–∫–∞–Ω—á–∏–≤–∞—é—Ç—Å—è –Ω–∞ 0 –∏–ª–∏ 5.\n"
        "üìå –ï—Å–ª–∏ –ø–æ—Å–ª–µ–¥–Ω—è—è —Ü–∏—Ñ—Ä–∞ –º–µ–Ω—å—à–µ 5 ‚Äî –æ–∫—Ä—É–≥–ª—è–µ–º –≤–Ω–∏–∑.\n"
        "üìå –ï—Å–ª–∏ 5 –∏–ª–∏ –±–æ–ª—å—à–µ ‚Äî –æ–∫—Ä—É–≥–ª—è–µ–º –≤–≤–µ—Ä—Ö."
    ),

    # ------------------------------------------------------------------
    # üü™ –í–û–ü–†–û–° 4 (–ü—Ä–∏–∫–ª–∞–¥–Ω–∞—è –∑–∞–¥–∞—á–∞: –ø–ª–æ—â–∞–¥—å)
    ## –ü–∞—Ç—Ç–µ—Ä–Ω paper_area
    # ------------------------------------------------------------------

    "area_basic": (
        "üìå –ü–ª–æ—â–∞–¥—å —Ñ–æ—Ä–º–∞—Ç–∞ A0 —Ä–∞–≤–Ω–∞ 10 000 —Å–º¬≤ (1 –º¬≤).\n"
        "üìå –ö–∞–∂–¥—ã–π —Å–ª–µ–¥—É—é—â–∏–π —Ñ–æ—Ä–º–∞—Ç –≤ 2 —Ä–∞–∑–∞ –º–µ–Ω—å—à–µ –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ.\n"
        "üìå –ü–æ—ç—Ç–æ–º—É –ø–ª–æ—â–∞–¥—å A4 ‚ùó<b>–ø—Ä–∏–º–µ—Ä–Ω–æ</b>‚ùó –≤ 16 —Ä–∞–∑ –º–µ–Ω—å—à–µ \n"
        "–ø–ª–æ—â–∞–¥–∏ A0 (2‚Å¥ = 16) ‚Äî —ç—Ç–æ —É–¥–æ–±–Ω–æ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏.\n\n"
        "‚ùó –í–ê–ñ–ù–û: –≤ –±–ª–∞–Ω–∫ –û–ì–≠ –∑–∞–ø–∏—Å—ã–≤–∞–π —Ç–æ–ª—å–∫–æ —á–∏—Å–ª–æ –±–µ–∑ –µ–¥–∏–Ω–∏—Ü –∏–∑–º–µ—Ä–µ–Ω–∏–π. "
    ),

    "area_with_rounding_10": (
        "üìå –ß—Ç–æ–±—ã –ø–µ—Ä–µ–≤–µ—Å—Ç–∏ –º–º –≤ —Å–º, –Ω—É–∂–Ω–æ —Ä–∞–∑–¥–µ–ª–∏—Ç—å –Ω–∞ 10 \n"
        "(–ø–µ—Ä–µ–Ω–µ—Å—Ç–∏ –∑–∞–ø—è—Ç—É—é –Ω–∞ –æ–¥–∏–Ω –∑–Ω–∞–∫ –≤–ª–µ–≤–æ).\n"
        "üìå ¬´–ö—Ä–∞—Ç–Ω–æ 10¬ª –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ —á–∏—Å–ª–æ –∑–∞–∫–∞–Ω—á–∏–≤–∞–µ—Ç—Å—è –Ω–∞ 0.\n"
        "üìå –ß–∏—Ç–∞–π —É—Å–ª–æ–≤–∏–µ –≤–Ω–∏–º–∞—Ç–µ–ª—å–Ω–æ, —á—Ç–æ–±—ã –Ω–µ –æ—à–∏–±–∏—Ç—å—Å—è –ø—Ä–∏ –æ–∫—Ä—É–≥–ª–µ–Ω–∏–∏.\n"
        "–ò–Ω–æ–≥–¥–∞ –ø—Ä–æ—Å—è—Ç –æ–∫—Ä—É–≥–ª–∏—Ç—å –ø—Ä–æ—Å—Ç–æ –¥–æ —Ü–µ–ª–æ–≥–æ —á–∏—Å–ª–∞.\n\n"
        "‚ùó –í–ê–ñ–ù–û: –≤ –±–ª–∞–Ω–∫ –û–ì–≠ –∑–∞–ø–∏—Å—ã–≤–∞–π —Ç–æ–ª—å–∫–æ —á–∏—Å–ª–æ –±–µ–∑ –µ–¥–∏–Ω–∏—Ü –∏–∑–º–µ—Ä–µ–Ω–∏–π. "
    ),

    "area_with_rounding_5": (
        "üìå –°–Ω–∞—á–∞–ª–∞ –≤—ã—á–∏—Å–ª—è–µ–º —Ç–æ—á–Ω—É—é –ø–ª–æ—â–∞–¥—å, –∑–∞—Ç–µ–º –æ–∫—Ä—É–≥–ª—è–µ–º.\n"
        "üìå ¬´–ö—Ä–∞—Ç–Ω–æ 5¬ª –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ —á–∏—Å–ª–æ –∑–∞–∫–∞–Ω—á–∏–≤–∞–µ—Ç—Å—è –Ω–∞ 0 –∏–ª–∏ 5.\n"
        "üìå –ß–∏—Ç–∞–π —É—Å–ª–æ–≤–∏–µ –≤–Ω–∏–º–∞—Ç–µ–ª—å–Ω–æ, —á—Ç–æ–±—ã –Ω–µ –æ—à–∏–±–∏—Ç—å—Å—è –ø—Ä–∏ –æ–∫—Ä—É–≥–ª–µ–Ω–∏–∏.\n"
        "–ò–Ω–æ–≥–¥–∞ –ø—Ä–æ—Å—è—Ç –æ–∫—Ä—É–≥–ª–∏—Ç—å –ø—Ä–æ—Å—Ç–æ –¥–æ —Ü–µ–ª–æ–≥–æ —á–∏—Å–ª–∞.\n"
        "üìå –û–∫—Ä—É–≥–ª—è–µ–º —Ç–æ–ª—å–∫–æ –ø–ª–æ—â–∞–¥—å, –∞ –Ω–µ –¥–ª–∏–Ω—É –∏ —à–∏—Ä–∏–Ω—É –¥–æ —É–º–Ω–æ–∂–µ–Ω–∏—è.\n\n"
        "‚ùó –í–ê–ñ–ù–û: –≤ –±–ª–∞–Ω–∫ –û–ì–≠ –∑–∞–ø–∏—Å—ã–≤–∞–π —Ç–æ–ª—å–∫–æ —á–∏—Å–ª–æ –±–µ–∑ –µ–¥–∏–Ω–∏—Ü –∏–∑–º–µ—Ä–µ–Ω–∏–π. "
    ),

    # ------------------------------------------------------------------
    # üü´ –í–û–ü–†–û–° 5 (–ü—Ä–∏–∫–ª–∞–¥–Ω–∞—è –∑–∞–¥–∞—á–∞: –º–∞—Å—Å–∞)
    ## –ü–∞—Ç—Ç–µ—Ä–Ω paper_pack_weight
    # ------------------------------------------------------------------

    "pack_weight": (
        "üìå –ü–ª–æ—â–∞–¥—å –ª–∏—Å—Ç–∞ A0 —Ä–∞–≤–Ω–∞ 1 –º¬≤ ‚Äî —ç—Ç–æ –æ—Å–Ω–æ–≤–∞ –≤—Å–µ–π —Å–∏—Å—Ç–µ–º—ã —Ñ–æ—Ä–º–∞—Ç–æ–≤ —Å–µ—Ä–∏–∏ A.\n"
        "üìå –ö–∞–∂–¥—ã–π —Å–ª–µ–¥—É—é—â–∏–π —Ñ–æ—Ä–º–∞—Ç –≤ 2 —Ä–∞–∑–∞ –º–µ–Ω—å—à–µ –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ, \n"
        "–∑–Ω–∞—á–∏—Ç –∏ –º–∞—Å—Å–∞ –≤ 2 —Ä–∞–∑–∞ –º–µ–Ω—å—à–µ.\n"
        "üìå –ß—Ç–æ–±—ã –Ω–∞–π—Ç–∏ –º–∞—Å—Å—É –ø–∞—á–∫–∏, —Å–Ω–∞—á–∞–ª–∞ –Ω–∞—Ö–æ–¥—è—Ç –º–∞—Å—Å—É –æ–¥–Ω–æ–≥–æ –ª–∏—Å—Ç–∞.\n"
        "üìå –ú–∞—Å—Å–∞ –ø–∞—á–∫–∏ ‚Äî —ç—Ç–æ –º–∞—Å—Å–∞ –æ–¥–Ω–æ–≥–æ –ª–∏—Å—Ç–∞, —É–º–Ω–æ–∂–µ–Ω–Ω–∞—è –Ω–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ª–∏—Å—Ç–æ–≤ –≤ –ø–∞—á–∫–µ."
    ),

    # ------------------------------------------------------------------
    # üüß –í–û–ü–†–û–° 6 (–ü—Ä–∏–∫–ª–∞–¥–Ω–∞—è –∑–∞–¥–∞—á–∞: –º–∞—Å—à—Ç–∞–±)
    ## –ü–∞—Ç—Ç–µ—Ä–Ω paper_font_scaling
    # ------------------------------------------------------------------

    "font_scaling": (
        "üìå –ó–∞–ø–æ–º–Ω–∏ ¬´–º–∞–≥–∏—á–µ—Å–∫–∏–µ —á–∏—Å–ª–∞¬ª –¥–ª—è –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è —à—Ä–∏—Ñ—Ç–∞:\n\n"
        "üîπ –†–∞–∑–Ω–∏—Ü–∞ 1 —Ñ–æ—Ä–º–∞—Ç:\n"
        "   (A4 ‚Üî A3) ‚Üí —É–º–Ω–æ–∂–∞–µ–º —à—Ä–∏—Ñ—Ç –Ω–∞ ‚àö2 ‚âà 1,4\n"
        "   (A4 ‚Üî A5) ‚Üí –¥–µ–ª–∏–º –Ω–∞ ‚àö2 ‚âà 1,4 (–∏–ª–∏ —É–º–Ω–æ–∂–∞–µ–º –Ω–∞ 0,7)\n\n"
        "üîπ –†–∞–∑–Ω–∏—Ü–∞ 2 —Ñ–æ—Ä–º–∞—Ç–∞:\n"
        "   (A4 ‚Üî A2) ‚Üí —É–º–Ω–æ–∂–∞–µ–º –∏—Å—Ö–æ–¥–Ω—ã–π —à—Ä–∏—Ñ—Ç –Ω–∞ 2 (—ç—Ç–æ (‚àö2)¬≤)\n"
        "   (A4 ‚Üî A6) ‚Üí –¥–µ–ª–∏–º –Ω–∞ 2\n\n"
        "üîπ –†–∞–∑–Ω–∏—Ü–∞ 3 —Ñ–æ—Ä–º–∞—Ç–∞:\n"
        "   (A7 ‚Üî A4) ‚Üí —É–º–Ω–æ–∂–∞–µ–º —à—Ä–∏—Ñ—Ç –Ω–∞ 2,8 (—ç—Ç–æ (‚àö2)¬≥ –∏–ª–∏ 2 ¬∑ 1,4)\n"
        "   (A4 ‚Üî A7) ‚Üí –¥–µ–ª–∏–º –Ω–∞ 2,8 (–∏–ª–∏ —É–º–Ω–æ–∂–∞–µ–º –Ω–∞ 0,35)\n\n"
        "üìå <b>–ì–ª–∞–≤–Ω–æ–µ –ø—Ä–∞–≤–∏–ª–æ:</b>–°—Ç–µ–ø–µ–Ω—å —É ‚àö2 –≤—Å–µ–≥–¥–∞ —Ä–∞–≤–Ω–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤—É —à–∞–≥–æ–≤ –ø–µ—Ä–µ—Ö–æ–¥–∞ –º–µ–∂–¥—É —Ñ–æ—Ä–º–∞—Ç–∞–º–∏.\n\n"
        "‚ùó –í–ê–ñ–ù–û: –û–∫—Ä—É–≥–ª–µ–Ω–∏–µ –≤—ã–ø–æ–ª–Ω—è–µ–º —Ç–æ–ª—å–∫–æ –≤ —Å–∞–º–æ–º –∫–æ–Ω—Ü–µ –≤—ã—á–∏—Å–ª–µ–Ω–∏–π!"
    ),
}


# =============================================================================
# 2. –ü–†–û–§–ò–õ–ò –ù–ê–†–†–ê–¢–ò–í–û–í (–∫–∞–Ω–æ–Ω)
# =============================================================================

NARRATIVE_PROFILES: Dict[str, Dict[str, Any]] = {

    # ===============================
    # Q1 ‚Äî paper_format_match
    # ===============================
    "match_formats_to_rows": {
        "idea_key": "match_formats_to_rows",
        "steps": [
            "STEP_MATCH_COMPARE",
            "STEP_MATCH_SEQUENCE",
        ],
        "tips_key": "match_formats_to_rows",
        "required_fields": [
            # –∏–∑ JSON
            "row_to_format_mapping",
            "answer_sequence",

            # –≤—ã—á–∏—Å–ª—è–µ—Ç—Å—è solver'–æ–º –¥–ª—è STEP_MATCH_COMPARE
            "row_1", "row_2", "row_3", "row_4",
            "len_1", "len_2", "len_3", "len_4",
            "format_1", "format_2", "format_3", "format_4",

            # –≤—ã—á–∏—Å–ª—è–µ—Ç—Å—è solver'–æ–º –¥–ª—è STEP_MATCH_SEQUENCE
            "requested_order",
        ],
    },

    # ===============================
    # Q2 ‚Äî paper_split
    # ===============================
    "count_subformats": {
        "idea_key": "count_subformats",
        "steps": [
            "STEP_SPLIT_DIFF",
            "STEP_SPLIT_POWER",
        ],
        "tips_key": "count_subformats",
        "required_fields": [
            "from_format",
            "to_format",
            "from_index",
            "to_index",
            "index_difference",
            "transition_chain",
            "doubling_chain",
            "sup_power",
            "power_value",
        ],
    },

    # ===============================
    # Q3 ‚Äî paper_dimensions
    # ===============================
    "find_length": {
        "idea_key": "find_length",
        "steps": [
            "STEP_DIM_LENGTH",
        ],
        "tips_key": "find_length",
        "required_fields": [
            "format",
            "row_number",
            "selected_value",
        ],
    },

    "find_width": {
        "idea_key": "find_width",
        "steps": [
            "STEP_DIM_WIDTH",
        ],
        "tips_key": "find_width",
        "required_fields": [
            "format",
            "row_number",
            "selected_value",
        ],
    },

    "find_side": {
        "idea_key": "find_side",
        "steps": [
            "STEP_DIM_SIDE_GIVEN",
            "STEP_DIM_SIDE_COMPARE",
        ],
        "tips_key": "find_side",
        "required_fields": [
            "format",
            "row_number",
            "length_mm",
            "width_mm",
            "selected_value",
            "other_value",
        ],
    },

    "find_ratio": {
        "idea_key": "find_ratio",
        "steps": [
            "STEP_RATIO_ORDER",
            "STEP_RATIO_CALC",
        ],
        "tips_key": "find_ratio",
        "required_fields": [
            "division_order",
            "division_expression",
            "raw_ratio",
            "rounded_ratio",
        ],
    },

    "find_diagonal_ratio": {
        "idea_key": "find_diagonal_ratio",
        "steps": [
            "STEP_DIAG_ORDER",
            "STEP_DIAG_RATIO",
        ],
        "tips_key": "find_diagonal_ratio",
        "required_fields": [
            "side_type",
            "ratio_value",
        ],
    },

    "find_with_rounding": {
        "idea_key": "find_with_rounding",
        "steps": [
            "STEP_ROUND_GIVEN",
            "STEP_ROUND_PROCESS",
        ],
        "tips_key": "find_with_rounding",
        "required_fields": [
            "format",
            "row_number",
            "side_name",
            "original_value",
            "round_base",
            "lower_value",
            "upper_value",
            "rounded_value",
        ],
    },

    # ===============================
    # Q4 ‚Äî paper_area
    # ===============================
    "area_basic": {
        "idea_key": "area_basic",
        "steps": [
            "STEP_AREA_BASIC_SIZES",
            "STEP_AREA_BASIC_CALC",
        ],
        "tips_key": "area_basic",
        "required_fields": [
            "format",
            "length_mm",
            "width_mm",
            "length_cm",
            "width_cm",
            "area_raw",
        ],
    },

    "area_with_rounding_10": {
        "idea_key": "area_with_rounding_10",
        "steps": [
            "STEP_AREA_R10_SIZES",
            "STEP_AREA_R10_CALC",
            "STEP_AREA_R10_ROUND",
        ],
        "tips_key": "area_with_rounding_10",
        "required_fields": [
            "format",
            "length_mm",
            "width_mm",
            "length_cm",
            "width_cm",
            "area_raw",
            "rounded_area",
            "round_base",
            "lower_value",
            "upper_value",
        ],
    },

    "area_with_rounding_5": {
        "idea_key": "area_with_rounding_5",
        "steps": [
            "STEP_AREA_R5_SIZES",
            "STEP_AREA_R5_CALC",
            "STEP_AREA_R5_ROUND",
        ],
        "tips_key": "area_with_rounding_5",
        "required_fields": [
            "format",
            "length_mm",
            "width_mm",
            "length_cm",
            "width_cm",
            "area_raw",
            "rounded_area",
            "round_base",
            "lower_value",
            "upper_value",
        ],
    },

    # ===============================
    # Q5 ‚Äî pack_weight
    # ===============================
    "pack_weight": {
        "idea_key": "pack_weight",
        "steps": [
            "STEP_PACK_COUNT",
            "STEP_PACK_SINGLE_WEIGHT",
            "STEP_PACK_TOTAL",
        ],
        "tips_key": "pack_weight",
        "required_fields": [
            "from_format",
            "to_format",
            "from_index",
            "to_index",
            "index_difference",
            "sheet_count",
            "mass_per_m2",
            "single_weight",
            "pack_size",
            "total_weight",
        ],
    },

    # ===============================
    # Q6 ‚Äî font_scaling
    # ===============================
    "font_scaling": {
        "idea_key": "font_scaling",
        "steps": [
            "STEP_FONT_DIRECTION",
            "STEP_FONT_SCALE",
            "STEP_FONT_ROUND",
        ],
        "tips_key": "font_scaling",
        "required_fields": [
            "from_format",
            "to_format",
            "from_index",
            "to_index",
            "original_font",
            "step_count",
            "scale_formula",
            "scale_factor",
            "rounded_font",
        ],
    },
}


# =============================================================================
# 3. HELPERS
# =============================================================================

def _render_block(title: str, text: str) -> str:
    return f"{title}\n{text}"


# =============================================================================
# 4. –ö–û–ù–¢–ï–ö–°–¢-–ë–ò–õ–î–ï–†–´ (facts -> context)
# =============================================================================

def _default_context_builder(variables: Dict[str, Any]) -> Dict[str, Any]:
    return variables

def _rounding_context_builder(variables: Dict[str, Any]) -> Dict[str, Any]:
    context = variables.copy()

    original = context["original_value"]
    base = context["round_base"]

    # —Ñ–ª–∞–≥: —á–∏—Å–ª–æ —É–∂–µ –∫—Ä–∞—Ç–Ω–æ
    context["exact_multiple"] = (original % base == 0)

    return context

def _font_scaling_context_builder(variables: Dict[str, Any]) -> Dict[str, Any]:
    context = variables.copy()

    # üîπ –ó–Ω–∞–∫ –¥–ª—è —É–ø—Ä–æ—â–µ–Ω–∏—è —Ñ–æ—Ä–º—É–ª—ã
    if context.get("is_exact"):
        context["approx_sign"] = "="
    else:
        context["approx_sign"] = "="  # –í –ø–æ–¥—Ä–æ–±–Ω–æ–º —Ä–µ–∂–∏–º–µ —Ç–æ–∂–µ "="

    # üîπ –ò—Å—Ç–æ—á–Ω–∏–∫ –¥–ª—è —à–∞–≥–∞ –æ–∫—Ä—É–≥–ª–µ–Ω–∏—è
    if context.get("is_exact"):
        # exact ‚Üí –æ–∫—Ä—É–≥–ª—è—Ç—å –Ω–µ—á–µ–≥–æ, –Ω–æ –Ω–∞ –≤—Å—è–∫–∏–π —Å–ª—É—á–∞–π
        context["round_source"] = context.get("scaled_intermediate") or context.get("rounded_font")
    else:
        # non-exact ‚Üí –æ–∫—Ä—É–≥–ª—è–µ–º –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ
        context["round_source"] = context.get("scaled_intermediate")

    return context


_CONTEXT_BUILDERS: Dict[str, Callable[[Dict[str, Any]], Dict[str, Any]]] = {
    key: _default_context_builder for key in NARRATIVE_PROFILES.keys()
}

# üîµ –ü–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª—è–µ–º –¥–ª—è find_with_rounding
_CONTEXT_BUILDERS["find_with_rounding"] = _rounding_context_builder

# üîµ –î–ª—è font_scaling
_CONTEXT_BUILDERS["font_scaling"] = _font_scaling_context_builder

# =============================================================================
# 5. –ì–õ–ê–í–ù–ê–Ø –§–£–ù–ö–¶–ò–Ø (humanize)
# =============================================================================

def humanize(solution_core: Dict[str, Any]) -> str:

    narrative = solution_core["narrative"]

    # ‚ö†Ô∏è –í–ê–ñ–ù–û: –¥–µ–ª–∞–µ–º copy, —á—Ç–æ–±—ã –Ω–µ –º–µ–Ω—è—Ç—å solution_core –Ω–∞–ø—Ä—è–º—É—é
    variables = solution_core["variables"].copy()

    # üîµ –î–æ–±–∞–≤–ª—è–µ–º final_answer –≤ variables,
    # —á—Ç–æ–±—ã –æ–Ω –ø—Ä–æ—à—ë–ª —á–µ—Ä–µ–∑ numeric formatter
    variables["final_answer"] = solution_core["final_answer"]

    # –¢–µ–ø–µ—Ä—å –ø—Ä–æ–≥–æ–Ω—è–µ–º —á–µ—Ä–µ–∑ —Ñ–æ—Ä–º–∞—Ç—Ç–µ—Ä —á–∏—Å–µ–ª
    context = _format_numeric_values(variables)

    profile = NARRATIVE_PROFILES[narrative]

    required_fields = profile["required_fields"]
    for field in required_fields:
        if field not in variables:
            raise KeyError(f"Missing required field: {field}")

    # üíé –î–û–ü–û–õ–ù–ò–¢–ï–õ–¨–ù–ê–Ø –ü–†–û–í–ï–†–ö–ê –î–õ–Ø –ü–û–î–†–û–ë–ù–û–ì–û font_scaling
    if narrative == "font_scaling" and not variables.get("is_exact", True):
        for f in ("sqrt2_approx", "coef_approx", "scaled_intermediate"):
            if f not in variables or variables[f] is None:
                raise KeyError(f"Missing required field: {f}")

    # 1Ô∏è‚É£ –°—Ç—Ä–æ–∏–º –∫–æ–Ω—Ç–µ–∫—Å—Ç
    builder = _CONTEXT_BUILDERS.get(narrative, _default_context_builder)
    context = builder(variables)

    # 2Ô∏è‚É£ –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º —á–∏—Å–ª–∞
    context = _format_numeric_values(context)

    # 3Ô∏è‚É£ –†–µ–Ω–¥–µ—Ä–∏–º —à–∞–≥–∏
    profile = NARRATIVE_PROFILES[narrative]
    parts = []

    # IDEA
    idea_key = profile.get("idea_key")
    if idea_key and idea_key in IDEA_TEMPLATES:
        idea_text = IDEA_TEMPLATES[idea_key].format(**context)
        parts.append(_render_block("üí° <b>–ò–¥–µ—è —Ä–µ—à–µ–Ω–∏—è</b>", idea_text))

    # STEPS
    step_texts = []

    # üíé –ë–µ—Ä—ë–º —Ñ–ª–∞–≥–∏ —Å—Ç—Ä–æ–≥–æ –∏–∑ solver-–∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞
    is_exact = variables.get("is_exact", False)
    needs_rounding = variables.get("needs_rounding", False)

    for step_key in profile["steps"]:

        original_step_key = step_key  # —Å–æ—Ö—Ä–∞–Ω—è–µ–º –∏—Å—Ö–æ–¥–Ω—ã–π –∫–ª—é—á

        # üíé –î–ª—è font_scaling: –µ—Å–ª–∏ –ù–ï —Ç–æ—á–Ω—ã–π —Å–ª—É—á–∞–π ‚Äî –∏—Å–ø–æ–ª—å–∑—É–µ–º –ø–æ–¥—Ä–æ–±–Ω—ã–π —à–∞–±–ª–æ–Ω
        if original_step_key == "STEP_FONT_SCALE" and not is_exact:
            step_key = "STEP_FONT_SCALE_DETAILED"

        # üíé –ï—Å–ª–∏ –æ–∫—Ä—É–≥–ª–µ–Ω–∏–µ –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è ‚Äî —à–∞–≥ 3 –Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º
        if original_step_key == "STEP_FONT_ROUND" and not needs_rounding:
            continue

        # üîµ –°–ø–µ—Ü–∏–∞–ª—å–Ω–∞—è –ª–æ–≥–∏–∫–∞ –¥–ª—è find_with_rounding (–æ—Å—Ç–∞–≤–ª—è–µ–º –∫–∞–∫ –µ—Å—Ç—å)
        if step_key == "STEP_ROUND_PROCESS":

            if context.get("exact_multiple"):
                step_key = "STEP_ROUND_PROCESS_EXACT"

            elif context.get("is_middle"):
                step_key = "STEP_ROUND_PROCESS_MIDDLE"

            else:
                step_key = "STEP_ROUND_PROCESS_NORMAL"

        step_template = STEP_TEMPLATES[step_key]
        step_texts.append(step_template.format(**context))

    if step_texts:
        steps_block = "\n\n".join(step_texts)
        parts.append(_render_block("ü™ú <b>–ü–æ—à–∞–≥–æ–≤–æ–µ —Ä–µ—à–µ–Ω–∏–µ</b>", steps_block))

    # ANSWER
    parts.append(f"üéØ –û—Ç–≤–µ—Ç: <b>{context['final_answer']}</b>.")

    # TIPS
    tips_key = profile.get("tips_key")
    if tips_key and tips_key in TIPS_TEMPLATES:
        tips_text = TIPS_TEMPLATES[tips_key]
        parts.append(_render_block("‚ú® <b>–ü–æ–ª–µ–∑–Ω–æ –∑–Ω–∞—Ç—å</b>", tips_text))

    return "\n\n".join(parts)
